<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="{{asset('pictures/icons/soulicon.ico')}}" type="image/x-icon" />
    <link rel="shortcut icon" href="{{asset('pictures/icons/soulicon.ico')}}" type="image/x-icon" />
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <meta name="viewport" content="width=device-width, initial-scale=0.7, user-scalable=no">
    <meta name="fragment" content="!" />
    <link rel="stylesheet" type="text/css" href="{{ asset('css/bootstrap.min.css')}} ">
    <link rel="stylesheet" type="text/css" href="{{ asset('css/lightbox.css')}} " >
    <link rel="stylesheet" type="text/css" href="{{ asset('css/fonts.css')}} " >
    <link rel="stylesheet" type="text/css" href="{{ asset('css/slider.css')}} " >
    <link rel="stylesheet" type="text/css" href="{{ asset('css/component.css')}} " />
    <link rel="stylesheet" type="text/css" href="{{ asset('css/profilPage.css')}} " > 
    <link rel="stylesheet" type="text/css" href="{{ asset('css/board.css')}} " > 
    <link rel="stylesheet" type="text/css" href="{{ asset('css/soundtags.css')}} " > 
    <link rel="stylesheet" type="text/css" href="{{ asset('css/colorPicker.css')}} " > 
    <link rel="stylesheet" type="text/css" href="{{ asset('css/font-awesome.min.css')}} " > 
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'>
    <script type="text/javascript" src="{{ asset('js/angular.min.js')}}" ></script>
    <script type="text/javascript" src="{{ asset('components/webcomponentsjs/webcomponents.js')}}"></script>
    <link rel="import" href="{{ asset('components/paper-input/paper-input.html')}}">
    <link rel="import" href="{{ asset('components/core-icons/core-icons.html')}}">
    <link rel="import" href="{{ asset('components/core-icons/av-icons.html')}}">
    <link rel="stylesheet" type="text/css" href="{{ asset('css/soullerboard.css')}} " > 
    <title>{%if 'souller' in url('render_home_page') %}souller{% else %}scribbler party{%  endif %}</title>
</head>

<body ng-app="soullifiedApp">
<div id="cover-image" ></div>
<!-- Modal comment old-->
<div id="CommentDetailMoadl"  class="md-modal md-effect-2" >
  <div class="modal-dialog md-content" id="comment-modal-dialog">
    <div class="modal-content" style="border-radius: 12px;background-color: #F7F7F7;">
      <div class="modal-body"  id="writeacommentbody" style="width:100%;min-height: 280px;margin-bottom: 60px;overflow-x: hidden;overflow-y:auto;max-height: 500px;border-radius: 20px;">
      </div>
      <textarea id="writeacomment" placeholder="Write a comment" class="form-control" style="position: absolute;bottom: 70px;width: 95%;right: 20px;border-radius: 3px;margin-right:0;margin-left: 0;" ></textarea>
      <div class="modal-footer" style="border-bottom-right-radius: 8px;border-bottom-left-radius: 8px;padding-bottom: 15px;padding-top: 15px;padding-right: 15px;background-color: white;">
            <button class="btn btn-default md-close">Cancel</button>
            <button id="submitSubcomment" onClick="submitSubcomment()" class="btn btn-primary">Comment</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div id="fake-comment-trigger" class="submenu-item md-trigger" data-modal="CommentDetailMoadl" style="display:none;"> </div>
{%  if app.user %}
<div id="fake-bind-trigger" class="submenu-item md-trigger"  data-modal="bind-song" style="display:none;" ></div>
<div id="fake-filter-trigger" class="submenu-item md-trigger"  data-modal="filter-modal" style="display:none;" ></div>
{%  else %}
<div id="fake-choose-avatar-trigger" class="submenu-item md-trigger"  data-modal="chooseAvatar" style="display:none;" ></div>
{%  endif %}
<div id="fake-create-new-trigger" class="submenu-item md-trigger"  data-modal="new-board" style="display:none;" ></div>

<!-- Modal new board request-->
<div id="new-board" class="md-modal md-effect-2" style="width: 65%;max-width:initial;">
    <div id="d" onClick='$(".md-overlay").click();'>
    <a id="myboardslabelHref">
      <img id="myboardsLabelPicture" style="border-radius: 50%;height: 34px;width: 34px;margin-bottom: 10px;margin-left: 2px;background-color:white;" >
      <h2 id="myboardsLabel" style="text-transform:capitalize;display: inline-block;margin-left: 10px;"></h2>
    </a>
    <div id="grey-description">  
      <h2 id="boardModalTitle" style="
        font-family: 'Open Sans', sans-serif;
        color: rgb(228, 228, 228);text-transform:capitalize;
    "></h2>
      <p id="boardModalDescription"></p>
      <span id="modalBoardSoundTag" style="position:absolute;left:px;color:rgb(155, 155, 155);"></span>
      <span  id="boardModalLikesComments" style="
          position: absolute;
          right: 12px;
          color: rgb(155, 155, 155);
      ">
        <span id="modalBoardNbrLikers"></span> 
        <span id="modalBoardNbrComments"></span> 
      </span>
      </div>
      <span >
        <h2  id="youMightAlso"><span id="boardOwnersName"></span>'s boards</h2>
        <div id="myboardsBody" style="margin-top:0px;"></div>
      </span>
    </div>
</div><!-- /.modal -->

<div id="slider-container" class="thumbnail" style="display:none;">
  <form id="formRotateComment" method="POST" action="" > 
    <input id="myslider" type="text" size="10" class="slider-input">
      <div id="round-slider" class="slider-content"></div>  
        <div class="rotate-buttons" >
          <button class="btn btn-default" onClick="resetPrevious()">
            Cancel
          </button>
          <button class="btn btn-primary" onClick='submitRotation()' type="submit">
            Save changes
          </button>
        </div>
  </form>
</div>
{%  if app.user %}

<div id="filter-modal"  class="md-modal md-effect-2" style="width: 65%;max-width:initial;">
  <div class="modal-dialog md-content" style="width:auto;">
    <div class="modal-content">
      <div class="modal-header" style="display:none;">
        <h4 class="modal-title" id="myboardsLabel">Apply a filter</h4>
      </div>
      <div class="modal-body" id="filterBody" style="padding: 5px;overflow:hidden;text-align:center;" >
        <button type="button" class="close md-close"  aria-hidden="true">&times;</button>
        <h4 style="text-align:left;margin-left:15px;">Position</h4>
          <img class="filter-previews">
        <hr>
        <h4 style="text-align:left;margin-left:15px;">Filters</h4>
        <span style="position:relative;">
          <img class="filter-previews" style="-webkit-filter:blur(5px)" onClick="selectFilter(1)">
          <span style="position: absolute;top: 0%;left: 20%;color: white;font-size: 40px;z-index: 230;">Blur</span>
        </span>
        <span style="position:relative;">
          <img class="filter-previews" style="-webkit-filter:contrast(132%) brightness(100%);" onClick="selectFilter(2)">
          <span style="position: absolute;top: 0%;left: 20%;color: white;font-size: 40px;z-index: 230;">Opac</span>
        </span>
        <span style="position:relative;">
          <img class="filter-previews" onClick="selectFilter(3)">
          <span style="position: absolute;top: 0%;left: 20%;color: white;font-size: 40px;z-index: 230;">None</span>
        </span>
        <span style="position:relative;">
          <img class="filter-previews" onClick="selectFilter(3)">
          <span style="position: absolute;top: 0%;left: 20%;color: white;font-size: 40px;z-index: 230;">Red</span>
        </span>
      </div>
      <div class="modal-footer" style="padding-top: 14px;padding-bottom: 10px;">
          <a class="btn btn-default md-close" >Cancel</a>
          <button id="validate-filter-button"class="btn btn-primary md-close">It looks fine</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->



<!-- bind a song  request-->
<div id="bind-song"  class="md-modal md-effect-2" style="width: 65%;max-width:initial;">
  <div class="modal-dialog md-content" style="width:auto;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close md-close"  aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myboardsLabel">Add the song to a board</h4>
      </div>
      <div class="modal-body" id="myBoardToSelectBody" style="padding: 5px;">
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->




<div id="preview-trigger" class="submenu-item md-trigger"  data-modal="profilpicmodal" onClick="getEditId();fakeChooseTrigger()" style="display:none;"></div>
<!-- Modal info-->
<div id="infomodal"  class="md-modal md-effect-2"  >
  <div class="modal-dialog md-content" style="border-radius: 7px;">
    <div class="modal-content" style="border-radius: 7px;">
      <div class="modal-header" style="display:none;">
        <button type="button" class="close md-close" aria-hidden="true" style="position: absolute;  top: 6px;  right: 10px;" >&times;</button>
        <h4 class="modal-title" id="myModalLabel">Settings</h4>
      </div>
      <div class="modal-body" style="min-height: 430px;border-radius: 7px;">
        <button type="button" class="close md-close" aria-hidden="true" style="margin-top: -15px;margin-right: -10px;">&times;</button>
        <label style="margin-bottom:5px;margin-top: 0px;font-weight:bolder;">Title</label>
        <br>
        <input id="modalInfoTitle" type="text" placeholder="title" class="form-control">
        <label style="position:absolute;top:15px;font-weight:bolder;margin-left:17px">SoundTags</label>
        <select id="boardSoundtrackList" style="background-color: transparent;border:0px;cursor:pointer;margin-left:6px;">
              <option value="owner">no song selected</option>
        </select>

        <br>
        <label id="descriptionLabel" style="font-weight: bolder;">About:</label>
        <textarea id="modalInfoDescription" class="form-control description"></textarea>
        <span id="url-block">
          <h4 style="font-weight: bolder;">Url:
            <span style="font-weight:normal;margin-left:10px;">
              <a  style="font-family:sans-serif;">www.souller.com/board/ </a>
            </span>
            <input id="modalInfoUrl" type="text" placeholder="title" class="form-control" style="width: 270px;">
          </h4>
          <h4>
            Max letters in a scribble :
            <input id="maxLettersInput" type="text" placeholder="max letters" class="form-control" style="width:70px;">
          </h4>
        </span>
        <hr>
        <h4 style="font-weight: bolder;">Privacy:
        </h4>
        <span style="display:none;">
        Who can see this : 
        <select id="boardViewPrivacy" style="background-color: transparent;border:0px;cursor:pointer;">
              <option value="owner">Only You</option>
              <option value="public">Everyone</option>
              <option value="friends">Friends only</option>
        </select>
        <br>
        </span>
        


        Who can scribble here ?:
        <select id="boardCommentPrivacy" style="background-color: transparent;border:0px;cursor:pointer;">
              <option value="owner">Only You</option>
              <option value="public">Everyone</option>
              
        </select>         
      <br>
      <br>
      <a onclick="fakePreviewTriger()" style="font-weight: bolder;">Change Profil Picture:<br><img style="margin-left: 60px;  height: 70px;border-radius: 50%;" src="{{app.user.profil.profilPicture}}" class=""></a>
      <h4 style="font-weight: bolder;position: absolute;bottom: 165px;right: 160px;">Background:</h4>
      <a onClick="adjustAction()" style="position: absolute;bottom: 142px;left:338px;">Effect:<span style="font-family:sans-serif;margin-left:5px;color:black;" >Blur</span> </a>
      <div id="background-preview-group" style="bottom:0px;top: inherit;height: 120px;" >
                       <span id="background-file-uploader" class="file-uploader" onClick="setIsVelcroWallpaper()" style="display:inline-block;position: absolute;top: -10px;left: -49px;" ></span>
                        <span id="preview-backrounds">
                        </span>
      </div>
      <input type="hidden" name="predefinedbackgroud" id="predefinedbackgroud" >      
      <br>
      </div>
      <div class="modal-footer">
          <a class="btn btn-default md-close" >Cancel</a>
          <button id="deleteBoardInfoButton" class="btn btn-danger md-close hidden">Delete Board</button>
          <button id="submitBoardInfoButton" class="btn btn-primary md-close">Save Changes</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->




   <!-- Modal profil photo-->
   <div id="profilpicmodal" class="md-modal md-effect-2"  >
      <div class="modal-dialog md-content">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close md-close" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="myModalLabel">Change Profile Picture</h4>
          </div>
          <div class="modal-body" style="min-height: 340px;">
         <img id="profil-pic-preview" class="thumbnail" style="height:100px;border-radius:50%;width: 100px;box-shadow: 0 4px 6px -4px rgba(0, 0, 0, 0.6), 0 0 0px 1px rgba(255, 255, 255, 0.5);max-width: 370px;position: absolute;right: 40px;top: 10px;"  
           src="{{app.user.profil.ProfilPictureBig}}"
            />
              <div id="profilPic-file-uploader" class="file-uploader"></div>
              <span id="avatars-container"></span>
          </div>
          <div class="modal-footer">
              <a class="btn btn-default md-close" >Cancel</a>
              <button id="submitProfilPicture" onClick="saveProfilPicture(editId)" class="btn btn-primary md-close" >Save Changes</button> 

          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

{%  else %}


<!-- bind a song  request-->
<div id="chooseAvatar"  class="md-modal md-effect-2" style="width: 65%;max-width:initial;">
  <div class="modal-dialog md-content"  >
    <div class="modal-content" style="border-radius: 12px 12px 0px 0px;background-color:#F7F7F7;" >
      <div class="modal-header" style="background-color:white;text-align:center;font-weight:bold;font-size:20px;display:none;">
      </div>
      <div class="modal-body" style="padding: 20px;">
        <button id="close-choose" type="button" class="close md-close"  aria-hidden="true">&times;</button>
        <h3 class="modal-title" style="text-align:center;color:rgb(195, 195, 195)">Pick a Username & an Avatar </h3>
        <span id="username_token" style="color: red;padding: 9px;border-radius: 8px;z-index: 20;opacity: 0.8;top: 21px;position: absolute;cursor: pointer;right: 140px;font-family: sans-serif;display:none;">Username taken</span>
        <form id="form-avatar">
        <div id="no-chosen-avatar" class="alert alert-danger" style="margin-top: 10px;margin-right: 10px;width:initial;padding: 10px;display:none;" role="alert">Please choose an avatar !!</div>
        <div class="input-group" style="margin-left:0px;margin-bottom:25px;">
            <span class="input-group-addon"><img src="{{ asset('pictures/icons/tinyUserBlack.png') }}" style="margin-right: 7px;"></span>
            <input id="guestName" style='width: 75.5%;' name="email" type="text" class="form-control input-lg" placeholder="Username" required>
        </div>
        <hr style="margin-bottom:0px;">
        <br>
        <span id="avatars-container"></span>
        </div>
        <div class="modal-footer" style="padding-top: 14px;padding-bottom: 10px;background-color: white;">
            <a class="btn btn-default md-close" >Cancel</a>
            <button id="validate-username-button"class="btn btn-primary" type="confirm" disabled="true">Confirm</button>
        </div>
        </form>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<!-- ---------------------- sing up ---------------------------------- -->
<!-- Modal new board request-->
<div id="sign-up-trigger" class="md-modal md-effect-2" >
  <div class="modal-dialog md-content"  >
    <div class="modal-content" style="border-radius: 12px 12px 0px 0px;background-color:#F7F7F7;" >
      <div class="modal-header" style="background-color:white;text-align:center;font-weight:bold;font-size:20px">
        <button type="button" class="close md-close" >&times;</button>
        <span class="modal-title" id="myModalLabel">
          <br>
        </span>
      </div>
                                <div class="input-group" style="display:inline-block;">
                                    <a type="button" class="btn btn-primary btn-lg btn-block fb-btn" href="{{ asset('connect/facebook') }}" style="width: 260px;padding-left: 35px;font-size: 15px;"> 

                                        <img style="  position: absolute;background-color: #324D8F;top: 0px;left: 0px;padding: 8.5px;"   src="{{ asset('pictures/icons/facebook.png') }}"> Sing Up with facebook</a>
                                </div>
                                <div class="input-group" style="display:inline-block;" >
                                    
                                    <a type="button" class="btn btn-danger btn-lg btn-block"  href="{{ asset('connect/google') }}" style="width: 260px;padding-left: 15px;font-size: 15px;"> 
                                        <img style="padding: 9px;position: absolute;background-color: #D62A2A;top: 0px;left: 0px;" src="{{ asset('pictures/icons/google.png') }}"> Sing Up with Google+</a>
                                </div>
      <div class="modal-body" style="border-radius:0px 0px  12px 12px;" >
         <!-- <span style="position: absolute;font-size: 21px;width: 100%;top: 3px;margin-left: -27px;text-align: center;">Or</span> -->
             <div id="singup_block"  >
                <div class="input-group">
                </div>
               <hr style="border-color: rgba(0, 0, 0, 0.13);margin-right: 6%;margin-top:initial;">  
               <div style="font-size: 20px;text-align: center;margin-top: -35px;">Or <br>
             </div>
              <div id="emailGuestInput">
                <form action="/register">
                    <div class="input-group" style="margin-left: 10%;">
                        <span class="input-group-addon"><img src="{{ asset('pictures/icons/tiny-msg-black.png') }}" style="margin-right: 7px;">Email</span>
                        <input id="emailInput" style='width: 75.5%;' name="email" type="text" class="form-control input-lg" placeholder="No spams. Pinky swear !">
                    </div>
                    <!-- <div class="input-group" style="margin-left: 10%;display:none;">
                        <span class="input-group-addon" style="padding-right: 8px;"><img src="{{ asset('/pictures/icons/tinyUserBlack.png') }}" style="margin-right: 7px;">Name</span>
                        <input id="nameInput" style="width: 75.5%;" name="email" type="text" class="form-control input-lg"  placeholder="Nick/name">
                    </div>  -->           
                    <div class="input-group" style="margin-left: 10%;margin-bottom: 28px;width:71%;" >
                        <button type="submit" class="btn btn-lg btn-success btn-block md-close" style="border-radius: 3px;" >Register with Email</button>
                    </div>      
                </form>
              </div>
        </div>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- Modal new board request-->
<div id="sign-in-trigger" class="md-modal md-effect-2" >
  <div class="modal-dialog md-content" >
    <div class="modal-content" style="border-radius: 12px 12px 0px 0px;" >
      <div class="modal-header" style="text-align:center;height:45px;border-radius:12px 12px  0px 0px;">
        <button type="button"  class="close md-close"  >&times;</button>
        <span class="modal-title" id="myModalLabel" ></span>
      </div>
      <div class="modal-body" style="border-radius:0px 0px  12px 12px;" >
         <!-- <span style="position: absolute;font-size: 21px;width: 100%;top: 64px;margin-left: -27px;text-align: center;">Or</span> -->
         <div id="singup_block"  >
              <div class="input-group" style="display:inline-block;">
                                    <a type="button" class="btn btn-primary btn-lg btn-block fb-btn" href="{{ asset('connect/facebook') }}" style="width: 260px;padding-left: 35px;font-size: 15px;"> 

                                        <img style="  position: absolute;background-color: #324D8F;top: 0px;left: 0px;padding: 8.5px;"   src="{{ asset('pictures/icons/facebook.png') }}"> Sing Up with facebook</a>
                                </div>
                                <div class="input-group" style="display:inline-block;" >
                                    
                                    <a type="button" class="btn btn-danger btn-lg btn-block"  href="{{ asset('connect/google') }}" style="width: 260px;padding-left: 15px;font-size: 15px;"> 
                                        <img style="padding: 9px;position: absolute;background-color: #D62A2A;top: 0px;left: 0px;" src="{{ asset('pictures/icons/google.png') }}"> Sing Up with Google+</a>
              </div>
              <hr style="border-color: rgba(0, 0, 0, 0.13);">

             <form action="{{ path('fos_user_security_check') }}" method="post" class="login-form" id="login">
                    <div class="input-group" style="margin-left: 15%;">
                        <span class="input-group-addon"><img src="{{ asset('pictures/icons/tinyUserBlack.png') }}"></span>
                        <input type="text" style="width: 77%;" class="form-control input-lg" placeholder="Username" id="username" name="_username" >
                    </div>
                   <div class="input-group" style="margin-left: 15%;">
                        <span class="input-group-addon"><img style="height: 26px;margin-right: -5px;margin-left: -5px;" src="{{ asset('pictures/icons/key.png') }}"></span>
                        <input type="password" style="width: 77%;" class="form-control input-lg" placeholder="Password" id="password" name="_password" />
                    </div>
                    <div class="input-group" style="margin-left: 15%;margin-bottom: 28px;width:67%;" >
                        <button class="btn btn-lg btn-success btn-block" style="border-radius: 3px;">Sing In</button>
                    </div>
            </form>
            </div>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
</div>
</div> 
<!-- ----------------------------- end sign up ------------------------------------ -->
{%  endif %}
<div id="header"> 
                <span id="board-title2"></span>
                |
                <span id="small-screen-menu" class="small-screen" onClick="displayMainMenue()" >
                  <img src="{{asset('pictures/icons/menu-icon-white.png')}}" >
                </span>
                {%  if app.user %}
                  <img id="Soundtagged" onMouseenter="displayPlayerContainer();" onMouseleave="hideplayerContainerTimeout=setTimeout(delayedMouseLeave,1000);" src="{{asset('pictures/icons/play-button.png')}}" style="display:none;opacity: 1;margin-right: -7px;margin-left: -12px;height: 35px;">
                  <input type="search" id="search-input"  style="width: 215px;display:none;">
                <span class="big-screen">
                  <img id="settings-trigger" src="{{asset('pictures/icons/settings-white.png')}}" style="opacity:1" class="md-trigger"  data-modal="infomodal" onClick="fillPreviewBackground()" />
                  <img id="Friend-requests" src="{{asset('pictures/icons/flag.png')}}" />
                  <img id="search-button" src="{{asset('pictures/icons/search-white.png')}}" onClick="expandSearchInput()" />
                  <input type="search" id="search-input"  style="width: 0px;display:none;margin-right:10px;">
                  <a href="{{path('render_home_page')}}">
                     <img id="home" src="{{asset('pictures/icons/campus.png')}}" style="border-radioddsds" />
                  </a>
                  <a id="myname" onClick="displayMainMenue()" >
                      <img id="profilpicthumb" style="opacity: 1;margin-top: -9px;width: 28px;height: 28px;border-radius: 50%;background-color:white;" 

                      src="{{app.user.profil.profilPicture}}" 
                        />
                    </a>
                  <img id="sideMenuTrigger" onClick="displaySideMenu()" src="{{asset('pictures/icons/menu-icon-white.png')}}" style="display:none;" />
                </span>
                {%  else %}
                <span class="big-screen">
                  <img id="search-button" src="{{asset('pictures/icons/search-white.png')}}" onClick="expandSearchInput()" />
                  <input type="search" id="search-input"  style="width: 0px;display:none;margin-right:10px;">
                  <img id="Soundtagged" onMouseenter="displayPlayerContainer();" onMouseleave="hideplayerContainerTimeout=setTimeout(delayedMouseLeave,1000);" src="{{asset('pictures/icons/play-button.png')}}" style="display:none;opacity: 1;margin-right: -7px;margin-left: -12px;height: 35px;">
                  <button id="sing-up-btn" class="btn btn-primary register-btn md-trigger"  data-modal="sign-up-trigger">register</button>
                  <button class="btn btn-default login-btn md-trigger" data-modal="sign-in-trigger" >login</button>
                  <button class="btn btn-default login-btn" onClick="exploreScrollDown()" >Explore</button>
                </span>
                {%  endif %}
  <span id="ghosmoslogo">
    <a href="/">
      <img src="{{asset('pictures/icons/soullogominiwhite.png')}}" id="img-logo" style="opacity: 1;height: 36px;position: absolute;top: -10px;left: 94px;">
    </a>

    <!-- <span style="font-weight:bold;margin-left: 35px;margin-right:0px;">Soul</span>lified -->
  </span>
</div>
<div  id="commentPic" style="width: 21%;
      top: 0;
      right: 2%;
      position: absolute;
      height: 570px;
      color: black;
      box-shadow: 0 1px 1px 0px rgba(0, 0, 0, 0.2), 0 0 2px 1px rgba(255, 255, 255, 0.5);
      margin-bottom: 8px;
      padding: 6px;
      padding-left: 10px;
      padding-right: 5px;
      line-height: 1.428571429;
      background-color: #fff;
      display:none;
      "
>
</div>
</div> <!-- end header -->


<div class="animateFade" ng-view></div>
<a id="next-button" >
  <img src="/pictures/icons/next-black.png"  >
</a>
<div id="explore" style="width: 100%;
  position: absolute;
  top: 100%;">

<div id="explore-header" class="vola-explore-header" style="height:50px;width:100%;background-color: rgb(3, 169, 244);z-index:1;top:0px;"></div>
<div id="explore-body" style="background-color:whitesmoke;height:auto;margin-top:50px;min-height: 400px;">

<core-header-panel  navigation flex mode="seamed" style="display:none;" class="tag-panel">
    <form flex id="add-song-form" >
          <paper-input  id="song-input"  icon="settings-power" label="##searchMessage##">
          </paper-input>
          <input  id="song-input-echo" style="width:100%;position:absolute;left:0px;top:65px;" placeholder="TypeSong Title" >
    </form>
</core-header-panel>



<div id="main-row" class="row">
<div id="explore-soundtrack-container" style="margin-top:50px;"></div>
    <div id="user-profil-card" class="explore-board">
      <a>
        <b>
          <a id="board-user-name"></a>
        </b>
      </a>
      <div>
        <img id="board-user-picture" style="width:150px;position:initial;height:150px;border-radius:50%;margin-left:45px;" class="comment-thumbnail">
      </div>
      <span >
      <a id="board-user-scrapbook-link">
          <img src="/pictures/icons/tinyBoardBlack.png" style="height: 16px;">
          <b>ScrapBook</b>
      </a>
      <div id="board-user-soundtags-link">
          <img src="/pictures/icons/tag_music.jpg" style="height: 20px;margin-left: -3px;margin-right: 0px;margin-bottom: 0px;">
          <b>Sound_Tags</b>
      </div>
      </span>
    </div>
    <div data-columns class="col-md-8 col-sm-12 col-xs-12 col-md-offset-2 col-sm-offset-0 col-xs-offset-0 boards-container">
      <div id="explore-container" class="cols" >

      </div>
      <div id="explorer-loading-html" style="text-align:center;background-color:white;width:100%;width: 50%;margin-left: 30%;box-shadow:0 1px 1px 0px rgba(0, 0, 0, 0.2), 0 0 2px 1px rgba(255, 255, 255, 0.5)"><img src="/pictures/icons/loading.gif" style="opacity:1;margin-top: 10px;margin-top: 12px;margin-bottom: 13px;margin-right: -0px;"><span class="awesome-loading">loading Awesomness ...</span></div>
    </div>
</div>


 <!-- end enxplore body -->
    </div>
  </div>
</div>
{%  if app.user %}
   {% include "PunkAveFileUploaderBundle:Default:templates.html.twig" %}
   {% include "soullifiedboardBundle:templates:UserMenuTemplate.html.twig" %}
{%  else %}
    <span id="psstText" >
   Psst !! Click on any empty spot to start scribbling</span>
   <style type="text/css">
    /* Generated with Bounce.js. Edit at http://goo.gl/y3FSYm */

@-webkit-keyframes animation { 
  0% { -webkit-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  3.4% { -webkit-transform: matrix3d(1.316, 0, 0, 0, 0, 1.407, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.316, 0, 0, 0, 0, 1.407, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  4.7% { -webkit-transform: matrix3d(1.45, 0, 0, 0, 0, 1.599, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.45, 0, 0, 0, 0, 1.599, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  6.81% { -webkit-transform: matrix3d(1.659, 0, 0, 0, 0, 1.893, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.659, 0, 0, 0, 0, 1.893, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  9.41% { -webkit-transform: matrix3d(1.883, 0, 0, 0, 0, 2.168, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.883, 0, 0, 0, 0, 2.168, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  10.21% { -webkit-transform: matrix3d(1.942, 0, 0, 0, 0, 2.226, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.942, 0, 0, 0, 0, 2.226, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  13.61% { -webkit-transform: matrix3d(2.123, 0, 0, 0, 0, 2.332, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.123, 0, 0, 0, 0, 2.332, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  14.11% { -webkit-transform: matrix3d(2.141, 0, 0, 0, 0, 2.331, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.141, 0, 0, 0, 0, 2.331, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  17.52% { -webkit-transform: matrix3d(2.208, 0, 0, 0, 0, 2.239, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.208, 0, 0, 0, 0, 2.239, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  18.72% { -webkit-transform: matrix3d(2.212, 0, 0, 0, 0, 2.187, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.212, 0, 0, 0, 0, 2.187, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  21.32% { -webkit-transform: matrix3d(2.196, 0, 0, 0, 0, 2.069, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.196, 0, 0, 0, 0, 2.069, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  24.32% { -webkit-transform: matrix3d(2.151, 0, 0, 0, 0, 1.96, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.151, 0, 0, 0, 0, 1.96, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  25.23% { -webkit-transform: matrix3d(2.134, 0, 0, 0, 0, 1.938, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.134, 0, 0, 0, 0, 1.938, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  29.03% { -webkit-transform: matrix3d(2.063, 0, 0, 0, 0, 1.897, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.063, 0, 0, 0, 0, 1.897, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  29.93% { -webkit-transform: matrix3d(2.048, 0, 0, 0, 0, 1.899, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.048, 0, 0, 0, 0, 1.899, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  35.54% { -webkit-transform: matrix3d(1.979, 0, 0, 0, 0, 1.962, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.979, 0, 0, 0, 0, 1.962, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  36.74% { -webkit-transform: matrix3d(1.972, 0, 0, 0, 0, 1.979, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.972, 0, 0, 0, 0, 1.979, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  41.04% { -webkit-transform: matrix3d(1.961, 0, 0, 0, 0, 2.022, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.961, 0, 0, 0, 0, 2.022, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  44.44% { -webkit-transform: matrix3d(1.966, 0, 0, 0, 0, 2.032, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.966, 0, 0, 0, 0, 2.032, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  52.15% { -webkit-transform: matrix3d(1.991, 0, 0, 0, 0, 2.006, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.991, 0, 0, 0, 0, 2.006, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  59.86% { -webkit-transform: matrix3d(2.006, 0, 0, 0, 0, 1.99, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.006, 0, 0, 0, 0, 1.99, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  63.26% { -webkit-transform: matrix3d(2.007, 0, 0, 0, 0, 1.992, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.007, 0, 0, 0, 0, 1.992, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  75.28% { -webkit-transform: matrix3d(2.001, 0, 0, 0, 0, 2.003, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.001, 0, 0, 0, 0, 2.003, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  85.49% { -webkit-transform: matrix3d(1.999, 0, 0, 0, 0, 2, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.999, 0, 0, 0, 0, 2, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  90.69% { -webkit-transform: matrix3d(1.999, 0, 0, 0, 0, 1.999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.999, 0, 0, 0, 0, 1.999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  100% { -webkit-transform: matrix3d(2, 0, 0, 0, 0, 2, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2, 0, 0, 0, 0, 2, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); } 
}

@keyframes animation { 
  0% { -webkit-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  3.4% { -webkit-transform: matrix3d(1.316, 0, 0, 0, 0, 1.407, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.316, 0, 0, 0, 0, 1.407, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  4.7% { -webkit-transform: matrix3d(1.45, 0, 0, 0, 0, 1.599, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.45, 0, 0, 0, 0, 1.599, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  6.81% { -webkit-transform: matrix3d(1.659, 0, 0, 0, 0, 1.893, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.659, 0, 0, 0, 0, 1.893, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  9.41% { -webkit-transform: matrix3d(1.883, 0, 0, 0, 0, 2.168, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.883, 0, 0, 0, 0, 2.168, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  10.21% { -webkit-transform: matrix3d(1.942, 0, 0, 0, 0, 2.226, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.942, 0, 0, 0, 0, 2.226, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  13.61% { -webkit-transform: matrix3d(2.123, 0, 0, 0, 0, 2.332, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.123, 0, 0, 0, 0, 2.332, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  14.11% { -webkit-transform: matrix3d(2.141, 0, 0, 0, 0, 2.331, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.141, 0, 0, 0, 0, 2.331, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  17.52% { -webkit-transform: matrix3d(2.208, 0, 0, 0, 0, 2.239, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.208, 0, 0, 0, 0, 2.239, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  18.72% { -webkit-transform: matrix3d(2.212, 0, 0, 0, 0, 2.187, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.212, 0, 0, 0, 0, 2.187, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  21.32% { -webkit-transform: matrix3d(2.196, 0, 0, 0, 0, 2.069, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.196, 0, 0, 0, 0, 2.069, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  24.32% { -webkit-transform: matrix3d(2.151, 0, 0, 0, 0, 1.96, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.151, 0, 0, 0, 0, 1.96, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  25.23% { -webkit-transform: matrix3d(2.134, 0, 0, 0, 0, 1.938, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.134, 0, 0, 0, 0, 1.938, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  29.03% { -webkit-transform: matrix3d(2.063, 0, 0, 0, 0, 1.897, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.063, 0, 0, 0, 0, 1.897, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  29.93% { -webkit-transform: matrix3d(2.048, 0, 0, 0, 0, 1.899, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.048, 0, 0, 0, 0, 1.899, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  35.54% { -webkit-transform: matrix3d(1.979, 0, 0, 0, 0, 1.962, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.979, 0, 0, 0, 0, 1.962, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  36.74% { -webkit-transform: matrix3d(1.972, 0, 0, 0, 0, 1.979, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.972, 0, 0, 0, 0, 1.979, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  41.04% { -webkit-transform: matrix3d(1.961, 0, 0, 0, 0, 2.022, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.961, 0, 0, 0, 0, 2.022, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  44.44% { -webkit-transform: matrix3d(1.966, 0, 0, 0, 0, 2.032, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.966, 0, 0, 0, 0, 2.032, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  52.15% { -webkit-transform: matrix3d(1.991, 0, 0, 0, 0, 2.006, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.991, 0, 0, 0, 0, 2.006, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  59.86% { -webkit-transform: matrix3d(2.006, 0, 0, 0, 0, 1.99, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.006, 0, 0, 0, 0, 1.99, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  63.26% { -webkit-transform: matrix3d(2.007, 0, 0, 0, 0, 1.992, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.007, 0, 0, 0, 0, 1.992, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  75.28% { -webkit-transform: matrix3d(2.001, 0, 0, 0, 0, 2.003, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2.001, 0, 0, 0, 0, 2.003, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  85.49% { -webkit-transform: matrix3d(1.999, 0, 0, 0, 0, 2, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.999, 0, 0, 0, 0, 2, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  90.69% { -webkit-transform: matrix3d(1.999, 0, 0, 0, 0, 1.999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1.999, 0, 0, 0, 0, 1.999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  100% { -webkit-transform: matrix3d(2, 0, 0, 0, 0, 2, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(2, 0, 0, 0, 0, 2, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); } 
}


   </style>

{%  endif %}

<span id="side-nav-menu" >
  <div class="menu-item menu-item" id="like-icon" style="border-top-right-radius: 5px;">
    <img id="like-icon-preview" style="display:none;">
  </div>
  <div class="menu-item" id="scrapbook-item" style="display:none;">
    <a  class="submenu-icons-white background-icon"></a>
  </div>
{%  if app.user %}
  <div class="menu-item" id="upload-photo-item" >
    <span id="side-photo-uploader" class="file-uploader"  onClick="handsOffTheTroll()" style="
    display: inline-block;
    position: absolute;
    top: 40px;
    left: -60px;
    z-index: 2;"
    ></span>
    <a class="submenu-icons-white board-icon" style="background-position: -459px -804px;"></a>
  </div>
{%  endif %}
  <div class="menu-item" id="my-boards-item" style="padding-left: 13px;padding-top: 5px;padding-bottom: 5px;cursor: pointer;">
    <core-icon icon="face" style="margin-right:0px;color:white;"></core-icon>
    <!-- <a class="submenu-icons-white board-icon"></a> -->
  </div>
  <div class="menu-item" id="soundtrack-item" style="padding-left: 13px;padding-top: 5px;padding-bottom: 5px;cursor: pointer;border-bottom-right-radius: 5px;display:none;">
    <core-icon icon="av:radio" style="margin-right:0px;color:white;"></core-icon>
  </div>

  <div class="menu-item" id="new-item"  style="border-bottom-right-radius: 5px;" >
    <a class="sosNeticonWhite plus-icon" 
      {%  if app.user %}
      href="/home#/new"
      {%  else  %}
        onClick="fakeRegisterTrigger()"
      {%  endif %}
     ></a>
  </div>
</span>
<div class="md-overlay" style="background: rgba(167, 186, 207, 0.59)"></div>
</body>
<script type="text/javascript" src="{{ asset('js/jquery-1.7.2.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('js/jquery.linkify.min.js') }}"></script>
<script type="text/javascript">
var playing =  false;
var commentEditId = 0
var editId;
var delay=0;
var commentEditedId = 0;
var app = angular.module('soullifiedApp',[])
.config(function($interpolateProvider){
        $interpolateProvider.startSymbol('##').endSymbol('##');
    })
//---------------------------- route ------------------------------------------------------
app.config(['$routeProvider',
    function($routeProvider){
  $routeProvider.
  when('/scrapbook/:nickName', {
    templateUrl:"/profiltemplate/angular",
    controller:'profilPageController'   
  }).
  when('/board/:boardId',{
    templateUrl:"/profiltemplate/angular",
    controller:'profilPageController'
  }).
  when('/soundtrack/:nickName',{
    templateUrl:"/soundtrack/angular",
    controller:'lifeSoundController'
  }).
  when('/pageNotFound',{
    templateUrl:"/404/notfound",
    controller:'pageNotFoundController'
  }).
  otherwise({redirectTo:'/pageNotFound',
});




}]);


app.directive('routeLoadingIndicator', function($rootScope) {
    return {
      restrict: 'E',
      template: "<div ng-show='isRouteLoading' class='loading-indicator'>" +
      "<div class='loading-indicator-body'>" +
      "<h3 class='loading-title'>Loading...</h3>" +
      "<div class='spinner'><rotating-plane-spinner></rotating-plane-spinner></div>" +
      "</div>" +
      "</div>",
      replace: true,
      link: function(scope, elem, attrs) {
        scope.isRouteLoading = false;
   
        $rootScope.$on('$routeChangeStart', function() {
          scope.isRouteLoading = true;
        });
        $rootScope.$on('$routeChangeSuccess', function() {
          scope.isRouteLoading = false;
        });
      }
    };
  });

app.controller("pageNotFoundController",function(){
  console.log("page not found");
})


app.controller('lifeSoundController',function($scope, $http , $routeParams){
  $scope.nickName=$routeParams.nickName;
  if($routeParams.nickName)
    var urlParams="?nickName="+$routeParams.nickName;

var options, a;
jQuery(function(){
    options = { serviceUrl:"http://ws.audioscrobbler.com/2.0/?method=track.search&api_key=543fc405ef684b058fa4808ce33ee018&format=json&limit=5&"};
    a = $('#song-input-echo').autocomplete(options);
}); 

var gSpaceIndex = 1;
var editedId;
var stopTyping;
$("#song-input").on("change keyup paste", function(){
    clearTimeout(stopTyping);
    stopTyping = setTimeout(completeTrack,500);
    if($("#song-input").val().indexOf(" ") == -1) 
      gSpaceIndex = 1;
    var spaceIndex = $("#song-input").val().split(" ").length;
    if(gSpafceIndex < spaceIndex) 
    {
      gSpaceIndex = spaceIndex;
    
      $("#song-input-echo").val($("#song-input").val())
      $("#song-input-echo").focus();
      $("#song-input").focus();
    }


})
hidePlayerContainer();
$("#like-icon").fadeIn();
var gSpaceIndex = 1;
var gtest;
$("textarea").on("change keyup paste", function(e){
    if((e.keyCode == 13)&&($(this).val().trim() != ""))
      submitComment($(this).attr("id").substr(12));
})

  while(intervalArray.length > 0)
   clearInterval(intervalArray.pop());

  $http({method:'GET',
         url:"{{path('soullifiedlifesoundtrack_get_angular_tracks')}}"+urlParams+"&?idx=0"
  })
  .success(function(data, status, headers){
    $scope.tracksArray = data.trackArray;
  {% if app.user %}
    if(data.user.nickName == "{{app.user.username}}")
      $scope.searchMessage = "Type song or artist name";
    else
      $scope.searchMessage = "#Tag "+data.user.fullName+" in a song !!";
  {% else %}  
      $scope.searchMessage = "#Tag "+data.user.fullName+" in a song !!";
  {%  endif %}

    $scope.idx = 0;
    $scope.user =  data.user;
    $scope.boards = data.boardsArray;
    var time=10000;
    for (var i = 0; i < $scope.tracksArray.length; i++) {
      if($scope.tracksArray[i].photos.length > 1 )
          {
            $scope.tracksArray[i].photos.idx = 0;
          }
    };

    $scope.ignoreScrolling = false;
    if($scope.user.background)
    {
      $("#cover-image").css("background-image","url("+$scope.user.background+")");
      $(".filter-previews").attr("src",$scope.user.background);
/*      if($scope.board.filter == 1)
        $("#cover-image").css("-webkit-filter","blur(5px)"); 
      else
        */
        $("#cover-image").css("-webkit-filter",""); 
    }
    var title=$scope.user.fullName+"'s Soundtrack";
    $("#board-title2")[0].innerHTML = title;
    $("#scrapbook-item").find("a").attr("href","/life/#/scrapbook/"+data.user.nickName);
    $("#soundtrack-item").attr("onClick","getExplorerSoundtrack("+data.user.nickName+")");
    $("#myboardsLabel")[0].innerHTML = data.user.nickName;
    $("#boardOwnersName")[0].innerHTML = encodeHTML(data.user.nickName);
    $("#board-user-name")[0].innerHTML = encodeHTML(data.user.fullName);
    $("#board-user-name").attr("href","/life/#/scrapbook/"+encodeHTML(data.user.nickName));
    $("#board-user-soundtags-link").attr("onClick","getExplorerSoundtrack('"+encodeHTML(data.user.nickName)+"')");
    $("#board-user-scrapbook-link").attr("href","/life/#/scrapbook/"+encodeHTML(data.user.nickName));
    $("#board-user-picture").attr("src",data.user.profilPic);
    $("#myboardsLabelPicture").attr("src",data.user.profilPic);
    $("#myboardslabelHref").attr("href","/life/#/scrapbook/"+data.user.nickName);
    $("#my-boards-item").attr("onClick","fakeCreatTrigger('"+data.user.nickName+"')");
    $("#modalInfoTitle").attr("value",title);
    $("#url-block")[0].style.display="none";
    $("textarea").on("change keyup paste", function(e){
              if((e.keyCode == 13)&&($(this).val().trim() != ""))
                submitComment($(this).attr("id").substr(12));
                })
  });
  
  if(firstTimeScrollDefined == true)
    {
      firstTimeScrollDefined = false;
      $(document).scroll(function(){
            if((-$(this).scrollTop() + $(this).height() < 100) && $scope.ignoreScrolling == false)
              //$scope.getNextWave();  
            return
      })
    }
    boardId = -1;
    if(editId == 0)
      getEditId();
    if(playing == false)
      $("#Soundtagged").fadeOut();

$scope.submitTrackComment =  function(track){
{% if app.user %}
  addComment(track.id,track.freshSubmcomment);
  track.freshSubmcomment="";
{% else %}
  fakeRegisterTrigger()
{% endif %}
}


$scope.fakeBindTrigger= function(trackId){
  $("#fake-bind-trigger").click();
  var loadingHTML='<div id="loading-html" style="text-align:center;background-color:white;width:100%;width: 50%;margin-left: 30%;box-shadow:0 1px 1px 0px rgba(0, 0, 0, 0.2), 0 0 2px 1px rgba(255, 255, 255, 0.5)"><img src="/pictures/icons/loading.gif" style="opacity:1;margin-top: 10px;margin-top: 12px;margin-bottom: 13px;margin-right: -0px;"><span class="awesome-loading">loading Awesomness ...</span></div>';
  $("#myBoardToSelectBody")[0].innerHTML = loadingHTML;
  var url="/angular/myboards";
  $.get(url,{
    nickName:$scope.user.nickName
  },function (data) {
    var finalHtml="";
    for (var i = 0; i < data.boards.length; i++) {
      var trackName="";
      var coverurl="";
      if (data.boards[i].coverurl)
        coverurl=data.boards[i].coverurl.replace("large","small");
      if (data.boards[i].song) {
        trackName='<span  style="text-align:left;color: rgb(139, 139, 139);font-size: 11px;opacity:0.5;"><img style="margin-right: 5px;opacity: 0.3;" src="/pictures/icons/small-song-black.png">'+data.boards[i].song+'</span>'+
                  '      <hr style="margin-bottom:0;margin-top:5px;">';
      }
      finalHtml=finalHtml+'<div id="tryBindMe'+data.boards[i].id+'" onClick="bindBoardToSong('+data.boards[i].id+','+trackId+')" class="my-boards" onClick="fakeModalClose()" style="background-image: url('+coverurl+');background-size: cover;">'+
      '    <a>'+
      '    <div >'+
      '      <div class="board-description" style="text-align:left;" >'+(data.boards[i].desc!=null?data.boards[i].desc:"")+'</div>'+
        '    <div class="likes-comments">'+
        '      <img class="small-community" src="/pictures/icons/small-owner.png">'+
        '      <img src="/pictures/icons/small-comment-black.png" class="like-buttons" style="opacity:0.3;margin-left:10px;cursor:default;">'+
        '      <span id="nbrOfComments">'+data.boards[i].nbrComments+'</span>'+
        '    </div>'+
        '    <div class="controls-buttons" style="display: block;">'+
        '      <hr style="margin-bottom:0;margin-top:5px;">'+
        trackName+
        '      <span class="board-title" style="text-align:left;">'+data.boards[i].name+'</span>'+
        '    </div>'+
        '  </div>'+
        '  </a>'+
        '</div>';
    };
    $("#myBoardToSelectBody")[0].innerHTML = finalHtml;
  })
}

$scope.getNextWave = function(){
  var loadingHTML='<div id="loading-html" class="col-md-5 col-sm-10 col-xs-10 col-md-offset-3 col-sm-offset-1 col-xs-offset-1 sub-container new-track-preview" style="text-align:center;background-color:white;"><img src="{{asset("pictures/icons/loading.gif")}}" style="opacity:1;margin-top: 12px;margin-right: 0%;"><span class="awesome-loading">loading Awesomness ...</span></div>';

  $("#tracks-row").append(loadingHTML);
  return -1;
  $scope.idx=$scope.idx+5;
  $scope.ignoreScrolling = true;
  var url = "{{path('soullifiedlifesoundtrack_get_angular_tracks')}}"
  $.get(url,{
             idx:$scope.idx,
             nickName:$scope.user.nickName
         },function(data){ 
          var tempArray = $scope.tracksArray.concat(data.trackArray);
          $scope.tracksArray = tempArray;
          $("#loading-html").remove();
          $scope.ignoreScrolling=false;
          $scope.$apply();
          $("textarea").on("change keyup paste", function(e){
              if((e.keyCode == 13)&&($(this).val().trim() != ""))
                submitComment($(this).attr("id").substr(12));
                })
        });
}
})

 app.controller('profilPageController',function($scope,$http, $routeParams){
  $("#main-container").overlay();
//------------------------------- Get comments  --------------------------------------------------------------
  $("#explore-soundtrack-container")[0].innerHTML="";
  $scope.nickName=$routeParams.nickName;
  if($routeParams.nickName)
    var urlParams="?nickName="+$routeParams.nickName;
  else if($routeParams.boardId)
    var urlParams="?boardId="+$routeParams.boardId;

  while(intervalArray.length > 0)
      clearInterval(intervalArray.pop());
    
  $http({method:'GET',
         url:"{{path('get_angular_comments')}}"+urlParams
  })
  .success(function(data, status, headers){
    $.fn.overlayout()
    $scope.board =data.board;
    $scope.boards = data.boardsArray;
    $scope.comments=data.commentArray;
    $scope.photos=data.photosArray;
    $scope.user = data.user;
    $scope.boards = data.boardsArray;
    $scope.isFirstClick =true;
    $scope.inputComment = new Object();
    var tempUpVotes=data.upvotesArray.filter(function(a){return a.isUp ==  true});
    var tempDownVotes=data.upvotesArray.filter(function(a){return a.isUp ==  false});
    $scope.upvotes= [];
    $scope.downvotes=[];
    for (var i = 0; i < tempUpVotes.length; i++) {
      $scope.upvotes.push(tempUpVotes[i].commentId);
    };

    for (var i = 0; i < tempDownVotes.length; i++) {
      $scope.downvotes.push(tempDownVotes[i].commentId);
    };


     if(!localStorage.getItem("guestName") && ($scope.board.commentPrivacy.indexOf("owner") == -1))
        {
          //$("#psstText").fadeIn();
          setTimeout('psstAlert()',3000);
        }
      else
        {
          $("#psstText").animate({right: "-600px"}, 200);
          $("#psstText").fadeOut();
        }
    if($("#boardSoundtrackList").length > 0)
    {
      var trackHtml="<option value='-1'>No Song Selected</option>";
        for (var i = 0; i < data.trackArray.length; i++) {
          if(data.trackArray[i].songtrackId == data.board.track.songtrackId)
            trackHtml=trackHtml+'<option  selected value='+data.trackArray[i].songtrackId+'>'+data.trackArray[i].title.substr(0,20)+'..</option>';
          else 
            trackHtml=trackHtml+'<option value='+data.trackArray[i].songtrackId+'>'+data.trackArray[i].title.substr(0,20)+'..</option>';
        };
        $("#boardSoundtrackList")[0].innerHTML=trackHtml;
    }


    console.log
    if(data.nextBoardIds.indexOf(data.board.boardUrl)!=-1 && (data.nextBoardIds[data.nextBoardIds.indexOf(data.board.boardUrl)+1]))
      $("#next-button").attr("href","/life/#/board/"+data.nextBoardIds[data.nextBoardIds.indexOf(data.board.boardUrl)+1]);
    else
      $("#next-button").attr("href","/life/#/board/"+data.nextBoardIds[0]);
    if(playing == false && data.trackArray[0] && $scope.board.isProfil)
    {
      
      //$("#Soundtagged").fadeIn();
      $("#player-giraffe").fadeIn();
      $("#player-track-title")[0].innerHTML = data.trackArray[0].title;
      $("#player-track-title-top")[0].innerHTML = data.trackArray[0].title;
      $("#player-track-picture").attr("src",data.trackArray[0].songPic);
      $("#track-owner-name")[0].innerHTML = data.user.nickName;
      if(data.trackArray[0].chosenLyrics!="null")
        $("#player-lyrics")[0].innerHTML = data.trackArray[0].chosenLyrics.substr(0,90)+"...";
      $("#player-link-soundtrack").attr("onClick","getExplorerSoundtrack('"+data.user.nickName+"')");
      
      try
      {
        loadSongTrack(data.trackArray[0].youtubeId);
      }catch(e){console.log("error can't init sound cloud "+e)}
      $("#Soundtagged").attr("onClick","play_track("+data.trackArray[0].youtubeId+")");
      $("#playerPlayButton").attr("onClick","play_track("+data.trackArray[0].youtubeId+")");
        if(!localStorage.getItem(data.user.nickName))
          {
            localStorage.setItem(data.user.nickName,"visited");
            console.log("clicked ");
            setTimeout("play_track("+data.trackArray[0].youtubeId+")",2000);
          }
      //$("#Soundtagged").fadeIn(1000) 
      $("#player-giraffe").fadeIn(1000);
    }
    else if($scope.board.track.id && playing == false)
    {
      //$("#Soundtagged").fadeIn();
      $("#player-giraffe").fadeIn();
      $("#player-track-title")[0].innerHTML = $scope.board.track.title;
      $("#player-track-title-top")[0].innerHTML = $scope.board.track.title;
      $("#player-track-picture").attr("src",$scope.board.track.songPic);
      $("#track-owner-name")[0].innerHTML = data.user.nickName;
      $("#player-link-soundtrack").attr("onClick","getExplorerSoundtrack('"+data.user.nickName+"')");
      if($scope.board.track.chosenLyrics!="null")
        $("#player-lyrics")[0].innerHTML=$scope.board.track.chosenLyrics.substr(0,90)+"...";
      try
      {
        loadSongTrack($scope.board.track.youtubeId);
      }catch(e){console.log("error can't init sound cloud "+e)}


      $("#Soundtagged").attr("onClick","play_track("+$scope.board.track.youtubeId+")");
      $("#playerPlayButton").attr("onClick","play_track("+$scope.board.track.youtubeId+")");
          if(!localStorage.getItem(data.user.nickName))
          {
            localStorage.setItem(data.user.nickName,"visited");
            console.log("clicked ");
            setTimeout("play_track("+$scope.board.track.youtubeId+")",2000);
          }
      //$("#Soundtagged").fadeIn(1000)
      $("#player-giraffe").fadeIn();
    }
    else if(playing ==  false)
    {
      //$("#Soundtagged").fadeOut();
      $("#player-giraffe").fadeOut();
    }
    else
    {
      //$("#Soundtagged").fadeIn();
      $("#player-giraffe").fadeIn();
    }

    $("#lifeSoundTrackTitle").tooltip({title:data.user.fullName+"'s Soundtrack",placement:"top"});
    $("#board-title2")[0].innerHTML = data.board.boardTitle;
    $("title")[0].innerHTML=data.board.boardTitle.replace("|","");
    $("#modalInfoTitle").attr("value",data.board.boardTitle.replace("|",""));
    $("#scrapbook-item").find("a").attr("href","/life/#/scrapbook/"+data.user.nickName);
    $("#soundtrack-item").attr("onClick","getExplorerSoundtrack('"+data.user.nickName+"')");
    $("#myboardsLabel")[0].innerHTML = data.user.nickName;
    $("#board-user-name")[0].innerHTML = data.user.fullName;
    $("#board-user-name").attr("href","/life/#/scrapbook/"+data.user.nickName);
    $("#board-user-scrapbook-link").attr("href","/life/#/scrapbook/"+data.user.nickName);
    $("#board-user-soundtags-link").attr("onClick","getExplorerSoundtrack('"+data.user.nickName+"')");
    $("#board-user-picture").attr("src",data.user.profilPic);
    $("#boardOwnersName")[0].innerHTML = data.user.nickName;
    $("#myboardsLabelPicture").attr("src",data.user.profilPic.replace("medium","thumbnails"));
    $("#myboardslabelHref").attr("href","/life/#/scrapbook/"+data.user.nickName);
    $("#boardModalTitle")[0].innerHTML = data.board.boardTitle.replace("|","");
    $("#maxLettersInput").val(data.board.maxLetters);
    if(data.board.isProfil ==false)
      {
        $("#modalInfoUrl").attr("value",data.board.boardUrl);
  {%  if app.user %}
          $("#url-block")[0].style.display="initial";
      }
    else
      $("#url-block")[0].style.display="none";
  {%  else %}
      }
  {%  endif %}
    
    $("#boardModalDescription")[0].innerHTML = data.board.boardDescription;
    if(data.board.maxheigth + 200 > window.innerHeight)
      {
        $("#main-container").css("min-height",data.board.maxheigth+200);
        $("#explore").css("top",data.board.maxheigth+200)
      }
    else
      {
        $("#main-container").css("min-height","");
        $("#explore").css("top","100%");
      }
    if(data.board.nbrComments > 0)
      $("#modalBoardNbrComments")[0].innerHTML = data.board.nbrComments+" scribbles";
    if(data.board.nbrLikes > 0)
     $("#modalBoardNbrLikers")[0].innerHTML = data.board.nbrLikes+'<img class="small-community"  src="{{asset("pictures/icons/small-owner.png")}}" style="margin-right:10px;margin-left:5px;">';
    else
      $("#modalBoardNbrLikers")[0].innerHTML = "";

    if(data.board.track.songtrackId)
      $("#modalBoardSoundTag")[0].innerHTML = '#'+data.board.track.title;
     else
      $("#modalBoardSoundTag")[0].innerHTML = ""
    $("#my-boards-item").attr("onClick","fakeCreatTrigger('"+data.user.nickName+"')");
    $("#modalInfoDescription").attr("value",data.board.boardDescription);
    $("#boardViewPrivacy").val(data.board.viewPrivacy);
    $("#boardCommentPrivacy").val(data.board.commentPrivacy);
    $("#submitBoardInfoButton").attr("onClick","submitBoardInfo("+data.board.boardId+")");
    $("#like-icon-preview")[0].style.display='initial';
    {%  if app.user %}
    $("#like-icon").fadeIn();
    if(data.board.liked == true)
      {
        $("#like-icon-preview").attr("onClick","unLikeBoard()");
        $("#like-icon-preview").attr("src","{{asset('pictures/icons/like-pink.png')}}");
      }
    else
      {
        $("#like-icon-preview").attr("onClick","likeBoard()");
        $("#like-icon-preview").attr("src","{{asset('pictures/icons/liked-white.png')}}")
      }
    if(data.board.isProfil == 1 || data.board.ownerId == {{app.user.profil.Id}})
    {
      $("#soundtrack-item").fadeIn();
    }
    else
    {
      $("#soundtrack-item")[0].style.display="none";
    }
    {%  else %}
        if(data.board.isProfil == 1)
        {
          $("#soundtrack-item").fadeIn();
        }
        else
        {
          $("#soundtrack-item")[0].style.display="none";
        }
        $scope.guest=new Object();
        if(!localStorage.getItem("guestName"))
          $scope.guest.name = "guest";
        else
          {
            $scope.guest.name = localStorage.getItem("guestName");
            $scope.guest.email = localStorage.getItem("guestEmail");
            $scope.guest.avatar = localStorage.getItem("guestAvatar");
          }
        $("#like-icon-preview").attr("onClick","likeBoard()");
        $("#like-icon-preview").attr("src","{{asset('pictures/icons/liked-white.png')}}")
    {%  endif %}
    if(!data.board.boardCover)
      {
        $("#cover-image").css("background-image","url({{asset('pictures/background/whitewood.jpg')}})");
      }
    else
      {
        $("#cover-image").css("background-image","url("+data.board.boardCover+")"); 
        $(".filter-previews").attr("src",data.board.boardCover);
        if(data.board.filter == 1)
          $("#cover-image").css("-webkit-filter","blur(5px)"); 
        else if(data.board.filter == 2)
          $("#cover-image").css("-webkit-filter","contrast(132%) brightness(100%)"); 
        else
          $("#cover-image").css("-webkit-filter",""); 
        //$("#cover-image").css("background-image","url("+data.board.boardCover+")");
      }
      $("#cover-image").ready(function () {
        $("#boardId"+expandId).remove()
      })
    boardId=data.board.boardId;
   {% if app.user %}
    if(editId == 0)
      getEditId();

     if(data.board.ownerId == {{app.user.profil.Id}})
      {
        $("#settings-trigger").fadeIn();
        $("#upload-photo-item").fadeIn();
        $("#soundtrack-item").fadeIn();
      }else
      {
        $("#settings-trigger")[0].style.display="none";
        $("#upload-photo-item")[0].style.display="none";
        
      }

    {%  endif %}




if(data.board.isProfil == true)
  {     
{% if app.user %}
    if(data.board.ownerId == {{app.user.profil.Id}})
      {
        $("#lifeListImage").draggable();
        $("#lifeListImage").mouseup(function(){
          var url="/life-according-to/updateposboard/"+boardId;
          var left = $("#lifeListImage").offset().left + 15;
          var top  = $("#lifeListImage").offset().top + 9;
          top=parseInt(top);
          left=parseInt(left)
/*          top = top / window.innerHeight;
          left = left / window.innerWidth;
          left = left * 100;
          top  = top * 100 + 5;*/
          $.get(url,{
            posy:top.toString().substr(0,4),
            posx:left.toString().substr(0,4),
            })
        })
      }
  {%  endif %}
    }
  else
  {
    //console.log("not profil")
  }
})  


var options, a;
jQuery(function(){
    options = { serviceUrl:"http://ws.audioscrobbler.com/2.0/?method=track.search&api_key=543fc405ef684b058fa4808ce33ee018&format=json&limit=5&"};
    a = $('#song-input-echo').autocomplete(options);
}); 


$scope.fakeTrigger =function (){
  var loadingmodal='<span id="loading-html" style="text-align:center;width: 93%;position: absolute;background-color: white;" ><img src="{{asset("pictures/icons/loading.gif")}}" style="opacity:1;margin-right:-45px;><span class="awesome-loading">loading Awesomeness ...</span></span>';
  
  $("#writeacommentbody")[0].innerHTML = loadingmodal;
  $("#fake-comment-trigger").click();
  $("#writeacomment").focus();
  $("#submitSubcomment").attr("onClick","submitSubcomment("+$scope.hoveredComment.commentId+")");
  var url= "{{path('comment_get_sub_comments')}}";
  $.get(url,{commentId:$scope.hoveredComment.commentId},
   function(data){   
        if(data.responseCode==200 ){
          var description="";
          if(data.subcommentsArray[0].description)
            description='<span style="color: black;font-size: 12px;font-weight:normal;"><hr style="margin-top: 3px;margin-bottom: 3px;">'+encodeHTML(data.subcommentsArray[0].description)+'</span>' ;

          var closeHtml="";
{%  if app.user %}
          if(data.subcommentsArray[0].ownerId == {{app.user.profil.id}})
            closeHtml='<button type="button" class="close"  style="position: absolute;top: 0px;right: 3px;" onClick="removeSubComment('+data.subcommentsArray[0].Id+')" >&times;</button>';
{%  endif %}


          var finalHtml='<div id="subcomment'+data.subcommentsArray[0].Id+'" class="new-board-preview" style="padding-left: 62px;margin-top: 7px;position:relative;width:100%;margin-left: 0px;height:auto;text-align:left;opacity: 1;min-height: 90px;min-height: 66px;font-weight:bold;">'+
                  '<span id="modalDetailCommentDate" style="position: absolute;bottom: 3px;right: 11px;font-size: 12px;font-weight:normal;">'+ data.subcommentsArray[0].date+' ago</span>'+
                    '<a id="modalDetailCommentOwnerFullname" style="text-transform: capitalize;position: absolute;top:0px;margin-left: 9px;font-size: 12px;font-weight: bold;">'+
                      encodeHTML(data.subcommentsArray[0].ownername)+
                    '</a>'+
                    '<img class="comment-thumbnail" style="left: 10px;height: 54px;" src="'+encodeHTML(data.subcommentsArray[0].ownerPicture)+'" />'+
                    '<div id="modalDetailCommentTitle" style="white-space:pre-wrap;margin-top: 10px;font-size: 12px;padding-bottom: 10px;font-family:sans-serif;display:inline-block;text-align: left;margin-left: 10px;padding-right: 75px;">'+encodeHTML(data.subcommentsArray[0].content)+description+'</div>'+closeHtml+'</div>';


          for (var i = 1; i < data.subcommentsArray.length; i++) {
          var closeHtml="";
      {%  if app.user %}
          if(data.subcommentsArray[i].ownerId == {{app.user.profil.id}})
            closeHtml='<button type="button" class="close"  style="position: absolute;top: 0px;right: 3px;" onClick="removeSubComment('+data.subcommentsArray[i].Id+')" >&times;</button>';
      {%  endif %}

          var myhtml= '<div id="subcomment'+data.subcommentsArray[i].Id+'" class="new-board-preview" style="padding-left: 62px;margin-top: 7px;position:relative;width:100%;margin-left: 0px;height:auto;text-align:left;opacity: 1;min-height: 90px;min-height: 66px;">'+
                  '<span id="modalDetailCommentDate" style="position: absolute;bottom: 3px;right: 11px;font-size: 12px;">'+ data.subcommentsArray[i].date+' ago</span>'+
                    '<a id="modalDetailCommentOwnerFullname" style="text-transform: capitalize;position: absolute;top:0px;margin-left: 9px;font-size: 12px;font-weight: bold;">'+
                      encodeHTML(data.subcommentsArray[i].ownername)+
                    '</a>'+
                    '<img class="comment-thumbnail" style="left: 10px;height: 54px;top: 2px;" src="'+encodeHTML(data.subcommentsArray[i].ownerPicture)+'" />'+
                    '<div id="modalDetailCommentTitle" class="new-board-preview-title" style="white-space:pre-wrap;font-weight:normal;margin-top: 10px;font-size: 12px;padding-bottom: 10px;font-family:sans-serif;display:inline-block;text-align: left;margin-left: 10px;padding-right: 75px;">'+encodeHTML(data.subcommentsArray[i].content)+'</div>'+closeHtml+'</div>';
                finalHtml=finalHtml+ myhtml;
          }
          
          $("#writeacommentbody")[0].innerHTML="";
          $("#writeacommentbody").append(finalHtml);
          $('#writeacommentbody').linkify();
        }
       });
};
//------------------------------ Popover comments -----------------------------------------------------------------------------
$scope.popoverAngularComment= function(comment){ 
      $scope.delayedHoveredComment = comment;
      $scope.delayedHoveredComment.shortContent=comment.content.substr(0,100);
      if(comment.content.length > 100 )
        {
          $scope.delayedHoveredComment.shortContent=$scope.delayedHoveredComment.shortContent+" ...";
          $scope.delayedHoveredComment.more = true;
        }
      if(comment.desc){
        $scope.delayedHoveredComment.shortDesc=comment.desc.substr(0,100);
        if(comment.desc.length > 100 )
          {
            $scope.delayedHoveredComment.shortDesc=$scope.delayedHoveredComment.shortDesc+" ...";
            $scope.delayedHoveredComment.more = true;
          }
        else
          if(comment.content.length <= 100 )
            $scope.delayedHoveredComment.more = false;
      }
      var pos;
      var postop;
      posTop = comment.posy / window.innerHeight;
      left = comment.posx / window.innerWidth;
      left = left * 100;
      posTop  = posTop * 100;

      pos=left;
      postop=posTop;

      if(postop < 25)
      { 
        $scope.delayedHoveredComment.placement="bottom";
        $scope.delayedHoveredComment.top =  $("#commentId"+$scope.delayedHoveredComment.commentId).offset().top + 25;
        $scope.delayedHoveredComment.left = $("#commentId"+$scope.delayedHoveredComment.commentId).offset().left - 150 + $("#commentId"+$scope.delayedHoveredComment.commentId).width() /2 ;
      }
      else
      {
        $scope.delayedHoveredComment.placement="top";
        $scope.delayedHoveredComment.top =  $("#commentId"+$scope.delayedHoveredComment.commentId).offset().top - 120;
        $scope.delayedHoveredComment.left = $("#commentId"+$scope.delayedHoveredComment.commentId).offset().left - 150 + $("#commentId"+$scope.delayedHoveredComment.commentId).width() /2 ;
      }

    if( window.innerWidth > 500)
    {
      if (pos<10)
          {
            $scope.delayedHoveredComment.placement="right";
            $scope.delayedHoveredComment.top =  $("#commentId"+$scope.delayedHoveredComment.commentId).offset().top - 50;
            $scope.delayedHoveredComment.left = $("#commentId"+$scope.delayedHoveredComment.commentId).offset().left + Math.min($("#commentId"+$scope.delayedHoveredComment.commentId).width(),420);
          }
          if (pos> 80)
          {
            $scope.delayedHoveredComment.placement="left";
            $scope.delayedHoveredComment.top =  $("#commentId"+$scope.delayedHoveredComment.commentId).offset().top - 50;
            $scope.delayedHoveredComment.left = $("#commentId"+$scope.delayedHoveredComment.commentId).offset().left - $("#commentId"+$scope.delayedHoveredComment.commentId).width() -220;
          }
    }

      if(comment.font=="arrow") {
        commentTitle="-->";
        trigger="click"
      }

      if(comment.font=="arrow") {
        commentTitle="-->";
        trigger="click"
      }
      else 
        commentTitle=comment.content;

      setTimeout(function(){
      if(!$("#commentId"+$scope.delayedHoveredComment.commentId).is(":hover"))
          return true;
     /** dirty Hacl TODO ReplceIt **/
      $scope.hoveredComment=$scope.delayedHoveredComment;
      $scope.$apply();
      $("#hoveredDescription")[0].innerHTML=$scope.delayedHoveredComment.shortDesc;
      $("#hoveredDescription").linkify();
      $('#popoverComment')[0].style.display="initial";
   },700);


{%  if app.user %}
    if($scope.board.ownerId=={{app.user.profil.Id}})
    {
      $(".comment").draggable();
      $(".board").draggable();
    }
{%  endif %}
 };
//----------------------------------------------------------- Hide Popover------------------------------------------------------
$scope.hidePopopver = function()
{
  setTimeout(function(){
  if($scope.hoveredComment)  
    {
      if(!$("#commentId"+$scope.hoveredComment.commentId).is(":hover") && ! $('#popoverComment').is(":hover"))
        {
          $('#popoverComment')[0].style.display="none";
        }
    }
  },500);
}
//----------------------------------------------------------- Hide Popover-------------------------------------------------------------------
$scope.hidePopopverFromPopverComment = function()
{
  setTimeout(function(){
     if(!$("#commentId"+$scope.hoveredComment.commentId).is(":hover") && ! $('#popoverComment').is(":hover"))
      {
        $('#popoverComment')[0].style.display="none";
      }
  },500);
}
//----------------------------------------------------------Set draggable ------------------------------------------------------------------
$scope.setDraggable = function()
{
  {% if app.user %}
    if($scope.board.ownerId == {{app.user.id}})
        {
          $(".board").draggable();
        }
  {% endif %}
}
//----------------------------------------------------------Up Vote ------------------------------------------------------------------
{%  if app.user %}
$scope.upvote = function()
{
  var downVoted=false;
  if($scope.upvotes.indexOf($scope.hoveredComment.commentId) != -1)
  {
    $scope.hoveredComment.votes--;
    $scope.hoveredComment.upVoted = false;
    $scope.hoveredComment.downVoted = false;      
    $scope.upvotes.splice($scope.upvotes.indexOf($scope.hoveredComment.commentId),1);
    url="/angular/comment/cancelvote";
    $.get(url,{commentId:$scope.hoveredComment.commentId});
  }
  else
  {
    $scope.hoveredComment.votes++;
    $scope.hoveredComment.upVoted = true;
    $scope.hoveredComment.downVoted = false;
    $scope.upvotes.push($scope.hoveredComment.commentId);
    if($scope.downvotes.indexOf($scope.hoveredComment.commentId) != -1)
    {
      $scope.downvotes.splice($scope.downvotes.indexOf($scope.hoveredComment.commentId),1);
      $scope.hoveredComment.votes++;
      downVoted=true;
    }
    url="/angular/comment/upvote";
    $.get(url,{commentId:$scope.hoveredComment.commentId,downVoted:downVoted});
  }
}
//----------------------------------------------------------Up Vote ------------------------------------------------------------------
$scope.downvote = function()
{
  var upVoted=false;
  if($scope.downvotes.indexOf($scope.hoveredComment.commentId) != -1)
  {
    $scope.hoveredComment.votes++;
    $scope.hoveredComment.upVoted = false;
    $scope.hoveredComment.downVoted = false;      
    $scope.downvotes.splice($scope.downvotes.indexOf($scope.hoveredComment.commentId),1);
    url="/angular/comment/cancelvote";
    $.get(url,{commentId:$scope.hoveredComment.commentId});
  }
  else
  {
    $scope.hoveredComment.votes--;
    $scope.hoveredComment.upVoted = false;
    $scope.hoveredComment.downVoted = true;
    $scope.downvotes.push($scope.hoveredComment.commentId);
    if($scope.upvotes.indexOf($scope.hoveredComment.commentId) != -1)
    {
      $scope.hoveredComment.votes--;
      $scope.upvotes.splice($scope.upvotes.indexOf($scope.hoveredComment.commentId),1);
      var upVoted=true;
    }
    url="/angular/comment/downvote";
    $.get(url,{commentId:$scope.hoveredComment.commentId,upVoted:upVoted});
  }
}
//----------------------------------------------------------remove picture -----------------------------------------------------------------
$scope.rmAngularPic = function(photo)
{
  $("#boardPhoto"+photo.Id).fadeOut();
  url="/removealbum/";
  url=url+photo.Id;
  $.get(url);
};
//-------------------------------------------------------------update pos pic-----------------------------------------------------------------
$scope.updatePosAngularPic = function(photo){
    var url ="{{ path('update_pos_album') }}";
    var left = $("#boardPhoto"+photo.Id).css("left");
    var top = $("#boardPhoto"+photo.Id).css("top");
    top=parseInt(top);
    left=parseInt(left)
    /*top = top / window.innerHeight;
    left = left / window.innerWidth;
    left = left * 100;
    top  = top * 100;*/
    $.get(url,{          
                album:photo.Id,
                left:parseFloat(left.toString().substr(0,4)),
                top:parseFloat(top.toString().substr(0,4))
              });
   };
//--------------------------------------------------------------update pos comment--------------------------------------------------------------
$scope.updatePosAngularcomment = function(comment){
    var url ='/updateposcomment/';
    var left = $("#commentId"+comment.commentId).css("left");
    var top = $("#commentId"+comment.commentId).css("top");
    top=parseInt(top);
    left=parseInt(left)
    /*top = top / window.innerHeight;
    left = left / window.innerWidth;
    left = left * 100;
    top  = top * 100;*/
    $.get(url+comment.commentId,{          
                                  left:parseFloat(left.toString().substr(0,4)),
                                  top:parseFloat(top.toString().substr(0,4))
                                });

    };

$scope.updatePosAngularBoard = function(board){
    var url ='/life-according-to/updateposboard/';
    var left = $("#boardId"+board.id).css("left");
    var top = $("#boardId"+board.id).css("top");
    top=parseInt(top);
    left=parseInt(left)
    /*top = top / window.innerHeight;
    left = left / window.innerWidth;
    left = left * 100;
    top  = top * 100;*/
    $.get(url+board.id,{          
                                  left:parseFloat(left.toString().substr(0,4)),
                                  top:parseFloat(top.toString().substr(0,4))
                                });

    };


$scope.unpinBoard = function(board){
    $("#boardId"+board.id).fadeOut();
    var url ="/board/setunpinned/"+board.id;
    $.get(url);

    };
{% else %}
  $scope.upvote = function(){
    fakeRegisterTrigger()
  }
  $scope.downvote = function(){
    fakeRegisterTrigger()
  }
{%  endif %}
//-----------------------------------------------------------------show comment container --------------------------------------
$scope.showCommentFormAngular = function(){
  depassementRight = false;
  //$("#trollphoto").remove();
  hideMainMenue();
  $scope.noSpace = false;
  {%  if app.user %}
    if($scope.board.commentPrivacy.indexOf("owner") == 0 && $scope.user.nickName.indexOf("{{app.user.username}}")!=0 )
      return true;
  {%  else %}
    if($scope.board.commentPrivacy.indexOf("owner") == 0)
      return true;
  {%  endif %}

  document.addEventListener( 'keyup', onDocumentKeyUp, false );
  if(!$("#comments").is(":hover") &&
     !$("#album-container").is(":hover") &&
     !$("#boards").is(":hover") &&
     !$("#subboards-container").is(":hover")) {
    var width = (window.innerWidth - mouse.x) / window.innerWidth * 100
    var height =(window.innerHeight - mouse.y) / window.innerHeight * 100

    if($scope.inputComment)
    {
      $scope.inputComment.content = "";
      $scope.inputComment.desc = "";
      $scope.inputComment.placement ="";
    }

    $("#comment-input-area").val("");
    $("#commentDescription").val("");
    $("#comment-area")[0].innerHTML="";
    $("#comment-container").css("top",mouse.y + $(document).scrollTop() -30); 
    $("#comment-container").css("left",mouse.x-20); 
if(height > 50 &&  width > 50)
//-----------mouse  top left --------------------------------//
  {
    $("#commentModal").css("top",mouse.y-40);
    $("#commentModal").css("left",mouse.x+250);
  }
//------------------------------------------------------//
if(height < 50 &&  width > 50)
//-----------mouse bottom left --------------------------------//
  {
    $("#commentModal").css("top",mouse.y-350);
    $("#commentModal").css("left",mouse.x+250);
  }


if(height < 50 &&  width < 50)
//-----------mouse bottom right --------------------------------//
  {
    $("#commentModal").css("top",mouse.y-350);
    $("#commentModal").css("left",mouse.x-700);
  }


if(height > 50 &&  width < 50)
//----------- top right --------------------------------//
  {
    $("#commentModal").css("top",mouse.y-40);
    $("#commentModal").css("left",mouse.x-700);
  }
    $("#commentModal").fadeIn();
    $("#comment-container").fadeIn(); 
    $("#comment-input-area").focus();
    $("#comment-area")[0].innerHTML=""
    $("#comment-form").css("-webkit-animation"," scale 0.5s");
  {% if app.user %}
    if(commentEditId == 0 && $scope.board.ownerId == {{app.user.id}})
    {
      getEditId();
    }
  {% endif %}
  }
  {
      $("#psstText").animate({right: "-600px"}, 200);
      $("#psstText").fadeOut();

    var fontTable=["JennaSue",
              "THURSTON_erc_002",
              "OwnThatShhhh",
              "comesinhandy",
              "BrookeS",
              "sketch_Block",
              "FAIL____",
              "daniel-webfont",
              "pops_08_BOLD",
              "pops_08_REGULAR",
              "Scribulous_Scrawlin___by_Alphabeta85",
              "Mawns_Handwriting",
              "LSTKGarPenTin",
              "Linny",
              "HappyFox-Condensed",
              "GoodDog",
              "FATSB___",
              "danielbk",
              "ArchitectsDaughter",
              "billy",
              "Chomp",
              "the_quiet_scream"];
              
    var colorsTable=["#000000"  ,"#000033"  ,"#000066"  ,"#000099"  ,"#0000CC"  ,"#0000FF",
                "#003300"   ,"#003333"  ,"#003366"  ,"#003399"  ,"#0033CC"  ,"#0033FF",
                "#006600"   ,"#006633"  ,"#006666"  ,"#006699"  ,"#0066CC"  ,"#0066FF",
                "#009900"   ,"#009933"  ,"#009966"  ,"#009999"  ,"#0099CC"  ,"#0099FF",
                "#00CC00"   ,"#00CC33"  ,"#00CC66"  ,"#00CC99"  ,"#00CCCC"  ,"#00CCFF",
                "#00FF00"   ,"#00FF33"  ,"#00FF66"  ,"#00FF99"  ,"#00FFCC"  ,"#00FFFF",
                "#330000"   ,"#330033"  ,"#330066"  ,"#330099"  ,"#3300CC"  ,"#3300FF",
                "#333300"   ,"#333333"  ,"#333366"  ,"#333399"  ,"#3333CC"  ,"#3333FF",
                "#336600"   ,"#336633"  ,"#336666"  ,"#336699"  ,"#3366CC"  ,"#3366FF",
                "#339900"   ,"#339933"  ,"#339966"  ,"#339999"  ,"#3399CC"  ,"#3399FF",
                "#33CC00"   ,"#33CC33"  ,"#33CC66"  ,"#33CC99"  ,"#33CCCC"  ,"#33CCFF",
                "#33FF00"   ,"#33FF33"  ,"#33FF66"  ,"#33FF99"  ,"#33FFCC"  ,"#33FFFF",
                "#660000"   ,"#660033"  ,"#660066"  ,"#660099"  ,"#6600CC"  ,"#6600FF",
                "#663300"   ,"#663333"  ,"#663366"  ,"#663399"  ,"#6633CC"  ,"#6633FF",
                "#666600"   ,"#666633"  ,"#666666"  ,"#666699"  ,"#6666CC"  ,"#6666FF",
                "#669900"   ,"#669933"  ,"#669966"  ,"#669999"  ,"#6699CC"  ,"#6699FF",
                "#66CC00"   ,"#66CC33"  ,"#66CC66"  ,"#66CC99"  ,"#66CCCC"  ,"#66CCFF",
                "#66FF00"   ,"#66FF33"  ,"#66FF66"  ,"#66FF99"  ,"#66FFCC"  ,"#66FFFF",
                "#990000"   ,"#990033"  ,"#990066"  ,"#990099"  ,"#9900CC"  ,"#9900FF",
                "#993300"   ,"#993333"  ,"#993366"  ,"#993399"  ,"#9933CC"  ,"#9933FF",
                "#996600"   ,"#996633"  ,"#996666"  ,"#996699"  ,"#9966CC"  ,"#9966FF",
                "#999900"   ,"#999933"  ,"#999966"  ,"#999999"  ,"#9999CC"  ,"#9999FF",
                "#99CC00"   ,"#99CC33"  ,"#99CC66"  ,"#99CC99"  ,"#99CCCC"  ,"#99CCFF",
                "#99FF00"   ,"#99FF33"  ,"#99FF66"  ,"#99FF99"  ,"#99FFCC"  ,"#99FFFF",
                "#CC0000"   ,"#CC0033"  ,"#CC0066"  ,"#CC0099"  ,"#CC00CC"  ,"#CC00FF",
                "#CC3300"   ,"#CC3333"  ,"#CC3366"  ,"#CC3399"  ,"#CC33CC"  ,"#CC33FF",
                "#CC6600"   ,"#CC6633"  ,"#CC6666"  ,"#CC6699"  ,"#CC66CC"  ,"#CC66FF",
                "#CC9900"   ,"#CC9933"  ,"#CC9966"  ,"#CC9999"  ,"#CC99CC"  ,"#CC99FF",
                "#CCCC00"   ,"#CCCC33"  ,"#CCCC66"  ,"#CCCC99"  ,"#CCCCCC"  ,"#CCCCFF",
                "#CCFF00"   ,"#CCFF33"  ,"#CCFF66"  ,"#CCFF99"  ,"#CCFFCC"  ,"#CCFFFF",
                "#FF0000"   ,"#FF0033"  ,"#FF0066"  ,"#FF0099"  ,"#FF00CC"  ,"#FF00FF",
                "#FF3300"   ,"#FF3333"  ,"#FF3366"  ,"#FF3399"  ,"#FF33CC"  ,"#FF33FF",
                "#FF6600"   ,"#FF6633"  ,"#FF6666"  ,"#FF6699"  ,"#FF66CC"  ,"#FF66FF",
                "#FF9900"   ,"#FF9933"  ,"#FF9966"  ,"#FF9999"  ,"#FF99CC"  ,"#FF99FF",
                "#FFCC00"   ,"#FFCC33"  ,"#FFCC66"  ,"#FFCC99"  ,"#FFCCCC"  ,"#FFCCFF",
                "#FFFF00"   ,"#FFFF33"  ,"#FFFF66"  ,"#FFFF99"  ,"#FFFFCC"  ,"#FFFFFF"]

    var rand = Math.floor(Math.random() * fontTable.length);
    $scope.isFirstClick=false;
    $("#comment-area")[0].style.fontFamily=fontTable[rand];
    $("#font-selector").val(fontTable[rand]);
    rand = Math.floor(Math.random() * colorsTable.length);
    $("#comment-area")[0].style.color=colorsTable[rand];
    $(".color").find("div")[0].style.backgroundColor=colorsTable[rand];
  } 

}
//-----------------------------------------------------------------hide comment container --------------------------------------
$scope.hideCommentFormAngular = function(){
  //$scope.inputComment=null;
  if(commentEditedId != 0)
  {
    $("#commentId"+commentEditedId)[0].innerHTML = $("#comment-input-area").val();
    $("#commentId"+commentEditedId).fadeIn();
  }
  $("#popoverFreshComment")[0].style.display="none";
  $("#commentModal").fadeOut();
  $(".popover .fade .top .in").fadeOut;
  $("#comment-container").fadeOut();
  document.removeEventListener( 'keyup', onDocumentKeyUp, false );
}
//-----------------------------------------------------------------Submit comment ----------------------------------------------
{%  if app.user %}
$scope.submitCommentAngular = function(board){
      var url="/myboard/addcomment/";
      url=url+board.boardId;      
      if($("#comment-form textarea").val()=="") {
        commentContainerFadeOut()
        return false;
      }
      if(commentEditId != 0)
      {
        var left = $("#boardPhoto"+commentEditId).parent().parent().offset().left+15;
        var top  = $("#boardPhoto"+commentEditId).parent().parent().offset().top+9;
        top=parseInt(top);
        left=parseInt(left)
        /*top = top / window.innerHeight;
        left = left / window.innerWidth;
        left = left * 100;
        top  = top * 100;*/
      }
     else
      {
        var left = $("#comment-area").offset().left;
        var top  = $("#comment-area").offset().top;
        top=parseInt(top);
        left=parseInt(left)
/*        top = top / window.innerHeight;
        left = left / window.innerWidth;
        left = left * 100;
        top  = top * 100;*/
      }
      $("#submit-comment").attr("disabled","true");
      $(".modal-footer").css("cursor","progress");
      $.post(url,{
           content:($scope.inputComment)?$scope.inputComment.content:"",
           allowedContent:$("#comment-area")[0].innerHTML,
           desc:($scope.inputComment)?$scope.inputComment.desc:"",
           size:$("#comment-area").css("font-size"),
           font:$("#comment-area").css("font-family"),
           color:$("#comment-area").css("color"),
           posx:left.toString().substr(0,4),
           posy:top.toString().substr(0,4),
           velcro:velcro,
           rotation:$('#comment-area').css('-webkit-transform'),
       },function(data){   
          if(data.responseCode==200 ){
            if(commentEditId == 0)
            {
              $scope.comments.push({
                     commentId:data.commentId,
                     posx:left.toString().substr(0,4),
                     posy:top.toString().substr(0,4),
                     rotation:$('#comment-area').css('-webkit-transform'),
                     color:$("#comment-area").css("color"),
                     allowedContent:$("#comment-area")[0].innerHTML,
                     content:$scope.inputComment.content,
                     desc:$scope.inputComment.desc,
                     size:$("#comment-area").css("font-size"),
                     font:$("#comment-area").css("font-family"),
                     commentDate:"just Now",
                     ownerId:"{{app.user.username}}",
                     votes:0,
                     fresh:true,
                     ownerFullName:'{{app.user.profil.fullname}}',
                     profilPic:'{{app.user.profil.profilPicture}}'
                   });
            }
            else
            {
              $scope.photos.push({Id:data.photoId,
                           Date:"Just Now",
                           folder:editId,
                           posx:left.toString().substr(0,4),
                           posy:top.toString().substr(0,4),
                           rotation:0,
                           title:$("#comment-input-area").val(),
                           url:1,
                          });
            $("#trollphoto").remove();
            }
            $scope.$apply();
            $("#submit-comment").removeAttr("disabled");
            $(".modal-footer").css("cursor","move");
            commentContainerFadeOut();
            commentEditId = 0;
            editId = 0;
            velcro = 0;
            $scope.inputComment.content = "";
            $scope.inputComment.desc = "";
            }
       });
}
{%  else %}
$scope.submitCommentAngular = function(board){
        localStorage.setItem("preComment",$("#comment-input-area").val());
        localStorage.setItem("preDesc",$("#commentDescription").val());
        localStorage.setItem("allowedContent",$("#comment-area").val());
        localStorage.setItem("preHref",document.location.href);
        var guestName;
        var guestEmail;
        var guestAvatar;
        if($("#guestName").val())
          {
            guestName = $("#guestName").val();
            guestEmail = $("#emailInput").val();
            localStorage.setItem("guestName",guestName);
          }
        else
          guestName = localStorage.getItem("guestName");

        if(!localStorage.getItem("guestName") || !localStorage.getItem("guestAvatar"))
          fakeChooseTrigger();
        else
          {
            var url="/myboard/addcomment/";
            url=url+board.boardId;      
            if($("#comment-form textarea").val()=="") {
              commentContainerFadeOut()
              return false;
            }
            var left = $("#comment-area").offset().left;
            var top  = $("#comment-area").offset().top;
            top=parseInt(top);
            left=parseInt(left)
/*            top = top / window.innerHeight;
            left = left / window.innerWidth;
            left = left * 100;
            top  = top * 100;*/
            $("#submit-comment").attr("disabled","true");
            $(".modal-footer").css("cursor","progress");
            $.post(url,{
                 content:($scope.inputComment)?$scope.inputComment.content:"",
                 allowedContent:$("#comment-area")[0].innerHTML,
                 desc:($scope.inputComment)?$scope.inputComment.desc:"",
                 size:$("#comment-area").css("font-size"),
                 font:$("#comment-area").css("font-family"),
                 color:$("#comment-area").css("color"),
                 posx:left.toString().substr(0,4),
                 posy:top.toString().substr(0,4),
                 hostVatar:localStorage.getItem("guestAvatar"),
                 hostName:guestName,
                 hostEmail:guestEmail,
                 velcro:0,
                 rotation:$('#comment-area').css('-webkit-transform'),
             },function(data){   
                if(data.responseCode==200 ){
                  if(commentEditId == 0)
                  {
                    $scope.comments.push({
                           commentId:data.commentId,
                           posx:left.toString().substr(0,4),
                           posy:top.toString().substr(0,4),
                           rotation:$('#comment-area').css('-webkit-transform'),
                           color:$("#comment-area").css("color"),
                           allowedContent:$("#comment-area")[0].innerHTML,
                           content:$scope.inputComment.content,
                           desc:$scope.inputComment.desc,
                           size:$("#comment-area").css("font-size"),
                           font:$("#comment-area").css("font-family"),
                           commentDate:"just Now",
                           ownerId:-1,
                           votes:0,
                           fresh:true,
                           ownerFullName:guestName,
                           isNewGuest:true,
                           profilPic:localStorage.getItem("guestAvatar")
                         });
                        }
                      }

                      $scope.$apply();
                      $("#submit-comment").removeAttr("disabled");
                      $(".modal-footer").css("cursor","move");
                      commentContainerFadeOut();
                      commentEditId = 0;
                      editId = 0;
                      velcro = 0;
                      $scope.inputComment.content = "";
                      $scope.inputComment.desc = "";
                 });
               }
        return 
}
{%  endif %}
//------------------------------ submit picture -----------------------------------------------------------------------------
$scope.submitPicture = function(){
  var url="{{ path('submit_angular_photo') }}";
  var left = $("#comment-area").offset().left+15;
  var top  = $("#comment-area").offset().top+9;
  top  = parseInt(top);
  left = parseInt(left)
  top  = top / window.innerHeight;
  left = left / window.innerWidth;
  left = left * 100 -14;
  top  = top * 100 -10;
  $.get(url,{editId:editId,
            boardId:boardId,
            title:$("#comment-input-area").val(),
            description:$("#commentDescription").val(),
            posx:left.toString().substr(0,4),
            posy:top.toString().substr(0,4)
   },function(data){   
            if(data.responseCode==200 ){
               $scope.photos.push({Id:data.photoId,
                           Date:"Just Now",
                           folder:editId,
                           posx:left.toString().substr(0,4),
                           posy:top.toString().substr(0,4),
                           rotation:0,
                           title:$("#comment-input-area").val(),
                           url:1,
                          });
          }
       });
  {%  if app.user %}
    $(".album").draggable();
  {%  endif %}
}

$("#color-selector").change(function() {
    var color=$(this).val();
    document.getElementById('comment-area').style.color=color;  
 }
);



//-----------------------------------------------------------finalizer----------------------------------------------------------
$("#comment-container").draggable();
$("#commentModal").draggable();
$("#comment-input-area").on("change keyup paste", function(e){
 // if($("#trollPhotoImg").length > 0)
      //$("#trollPhotoImg").css("padding-bottom","55px");
  if(!isEnoughtSpace())
    {      
      if($("#comment-area")[0].innerHTML.length >= $("#comment-input-area").val().length)
        {
          $("#comment-area")[0].innerHTML = $("#comment-input-area").val().substr(0,$scope.board.maxLetters);
          $scope.noSpace = false;
          depassementRight=false;
          $('#comment-container')[0].style.left = parseInt($('#comment-container')[0].style.left.replace("px",""))+5+"px";
        }
        else
          $scope.noSpace = true;
    }
  else
    {
      if($("#comment-input-area").val().length >= $scope.board.maxLetters )
        $scope.noSpace = true;
      else
        $scope.noSpace = false; 
      $("#comment-area")[0].innerHTML = $("#comment-input-area").val().substr(0,$scope.board.maxLetters);
      $("#popoverComment")[0].style.display="none";
    }
  if($("#"+editId+"label")[0])
  {
    $("#"+editId+"label").fadeIn();
    $("#"+editId+"label")[0].innerHTML = $("#comment-input-area").val().substr(0,$scope.board.maxLetters);
    //$("#boardPhoto"+editId).css("padding-bottom",$scope.board.maxLetters);
  }
  $("#freshTitle")[0].innerHTML = $("#comment-input-area").val().substr(0,$scope.board.maxLetters);
});
$("#commentDescription").focus(function(){
      $("#popoverComment")[0].style.display="none";
      var pos=$("#comment-area").offset().left;
      var postop=$("#comment-area").offset().top;
      toptop = parseInt(postop);
      pos = parseInt(pos)
      postop = postop / window.innerHeight;
      pos = pos / window.innerWidth;
      pos = pos * 100 ;
      postop  = postop * 100 ;
      if(postop < 25)
      { 
        $scope.inputComment.placement="bottom";
        $scope.inputComment.top =  $("#comment-area").offset().top + 25;
        $scope.inputComment.left = $("#comment-area").offset().left - 150 + $("#comment-area").width() /2 ;
      }
      else
      {
        $scope.inputComment.placement="top";
        $scope.inputComment.top =  $("#comment-area").offset().top - 120;
        $scope.inputComment.left = $("#comment-area").offset().left - 150 + $("#comment-area").width() /2 ;
      }

      if (pos<10)
      {
        $scope.inputComment.placement="right";
        $scope.inputComment.top =  $("#comment-area").offset().top - 50;
        $scope.inputComment.left = $("#comment-area").offset().left + Math.min($("#comment-area").width(),420);
      }
      if (pos> 80)
      {
        $scope.inputComment.placement="left";
        $scope.inputComment.top =  $("#comment-area").offset().top - 50;
        $scope.inputComment.left = $("#comment-area").offset().left - $("#comment-area").width() -220;
      }
      if($("#trollphoto").length > 0)
        $scope.inputComment.top = -400;
});

$(document).ready(function()
        {


      var $box = $('#colorPicker');
            $box.tinycolorpicker();
            var box = $box.data("plugin_tinycolorpicker")

            box.setColor("#ff0000");
    });

{%  if app.user %}
$("comment").draggable();
{%  endif %}
$(".rotate-small").tooltip({title:"rotate",placement:"bottom"});
$(".delete-small").tooltip({title:"delete",placement:"bottom"});
$(".comment-small").tooltip({title:"comment",placement:"bottom"});
/*$("#upvoteButton").tooltip({title:"upvote",placement:"bottom"});
$("#downvoteButton").tooltip({title:"downvote",placement:"bottom"});*/
$("#font-selector").change(function() {
  var font=$(this).val();
  document.getElementById('comment-area').style.fontFamily=font;;
  {%  if app.user %}
    var url="/profil/set/favvote";
    $.get(url,{profilId:'{{app.user.profil.id}}',
               favFont:font
             });
  {% endif %}
 });
});
var menucompressed=false;
 function compressMenu(){
    $(".side-main-menu").animate({width: "40px"}, 200);
    $(".label-icon").fadeOut(10);
    $(".sosNeticonWhite").animate({"margin-left": "-20px"}, 100);
    $(".submenu").fadeOut();
    menucompressed=true;
    $("#compress-menu").attr("onClick","uncompressMenu()");
    $("#compress-menu").css("background-position","258px 364px");
  }
  function uncompressMenu(){

    $(".side-main-menu").animate({width: "175px"}, 200);
    $(".sosNeticonWhite").animate({"margin-left": "0px"}, 100);
    $(".label-icon").delay(350).fadeIn();
    menucompressed=false;
    $("#compress-menu").attr("onClick","compressMenu()");
    $("#compress-menu").css("background-position","201px 364px");
  }
function saveBoardBackground(editId,boardId) {
  var url="";
  $.get(url,{editId:editId,boardId:boardId});
}
function saveProfilPicture(editId,srcStr)
{
  var url="{{ path('soullified_editprofilphoto') }}";
  $.get(url,{editId:editId});
  $(".comment-thumbnail").attr("src",srcStr);
  $("#profilpicthumb").attr("src",srcStr);
  $("#profil-pic-preview").attr("src",srcStr);

  editId = 0;
  commentEditId = 0;
  velcro = 0;
  isVelcroWallpaper=false;
}
function removeBackground()
{
  var url="{{path('remove_angular_background')}}";
  $.get(url,{boardId:boardId});
  $("#cover-image").css("background-image","");
}
function submitBoardInfo(boardId)
{
  var commentPrivacy = $("#boardCommentPrivacy").val();
  var viewPrivacy = $("#boardViewPrivacy").val();
  var newTitle = $("#modalInfoTitle").val();
  if(newTitle)
  {
    $("#board-title2")[0].innerHTML=newTitle;
    $("#boardModalTitle")[0].innerHTML=newTitle;
  }
  var newDescription = $("#modalInfoDescription").val();
  //ToDO convert to url
  var newUrl = $("#modalInfoUrl").val();
  var newMaxLetters = $("#maxLettersInput").val();
  if(newDescription)
  {
    $("#boardModalDescription")[0].innerHTML=newDescription;
  }
  var url="{{path('set_angular_board_info')}}";
  $.post(url,{boardId:boardId,
              newViewPrivacy:viewPrivacy,
              newCommentPrivacy:commentPrivacy,
              newTitle:newTitle,
              newUrl:newUrl,
              maxLetters:newMaxLetters,
              newDescription:newDescription
              });
}
var boardId;
function setPredefinedBackground(src){
  $("#background-preview-group img").attr("class","thumbnail small-background-preview");
  var predefinedId=$("#predefinedbackgroud").attr("value",src.getAttribute("src"));
  if(boardId == -1)
    var url="/soundtrack/updatebackground"
  else if(boardId == -2)
    var url="/wall/updatebackground"
  else
    var url="/updatepredefined/"+boardId;
  
  $.get(url,{
           predefinedId:predefinedId[0].value,
      },
        function(data){   
            if(data.responseCode==200 ){
            }
           }
       );
 $("#cover-image").css("background-image","url("+src.getAttribute("src")+")");
 $("#background-preview").attr("src",src.getAttribute("src"));
}

function saveUploadedBackground(id,src)
{
  $("#background-pic").attr("src",src);
  var url="{{path('edit_backgroundurl')}}";
    $.get(url,{
             editId:id,
             boardId:boardId
        });

}

function appendPicture(editId,srcStr) {
    var left = $("#comment-area").offset().left+15;
    var top  = $("#comment-area").offset().top+9;
    $("#comment-container").fadeOut();
    top = parseInt(top);
    left = parseInt(left);
    top = top / window.innerHeight;
    left = left / window.innerWidth;
    left = left * 100;
    top  = top * 100;
    var paddingBottom = "0";
    var commentContent = $("#comment-input-area").val()
   
    $("#album-container").append('<div id="trollphoto" class="board" style="position:absolute;width:180px;top:'+top.toString().substr(0,4)+'%;left:'+left.toString().substr(0,4)+'%;" ><div editId='+editId+' ng-mouseenter="setDraggable()">'+
        '<input id="pictureId'+editId+'" pictureId="'+editId+'" value="285" style="display:none;">'+
        '<span class="small-menu-icons" style="left: 0;top: 0;">'+
        '   <img class="rotate-small" id="rotateSmallPic'+editId+'"  src="/pictures/icons/small-rotate.png"  onClick=rotateslider("boardPhoto'+editId+',"pic") />'+
        '   <img class="delete-small" id="delteSmallPic'+editId+'" src="/pictures/icons/close.png"  ng-click="rmAngularPic(photo)" />'+
        '</span>'+
        '<a id="boardPhoto'+editId+'" data-lightbox="image-1" href="/web/uploads/tmp/attachments/'+editId+'/medium/1" >'+
        '<img id="trollPhotoImg" class="angularpiclabel" style="padding-bottom:'+paddingBottom+';" id="boardPhoto'+editId+'" src="'+srcStr+'"/>'+ 
        '</a>'+
        '</div>'+
        '<span class="board-title" id="'+editId+'label"  style="display:none;">'+commentContent+'</span></div>'
        );
     
      commentEditId = editId;
      $(".board").draggable();
      $("#boardPhoto"+editId)
      .mouseup(function(){
                  var url ="{{ path('update_pos_album') }}";
                  var left = $(this).offset().left;
                  var top = $(this).offset().top;
                  top = parseInt(top);
                  left = parseInt(left);
                  /*top = top / window.innerHeight;
                  left = left / window.innerWidth;
                  left = left * 100;
                  top  = top * 100;*/
                  $.get(url,{          
                          folder:$(this).attr("Id").replace("boardPhoto",""),
                          left:parseFloat(left.toString().substr(0,4)),
                          top:parseFloat(top.toString().substr(0,4))
                        });
              });


      if(handsOffTheTrollBool)
        {
          handsOffTheTrollBool;
          submitPic();
        }
}
$("#side-main-menu-container").fadeOut();

function displaySideMenu()
{
  $("#side-main-menu-container").fadeIn();
  $("#sideMenuTrigger").attr("onClick","hideSideMenu()");
}

function hideSideMenu()
{
  $("#side-main-menu-container").fadeOut();
  $("#sideMenuTrigger").attr("onClick","displaySideMenu()");
}
var gGoalId;
function addProgress(str,goalId){
  gGoalId=goalId;
  $("#progress-table")[0].innerHTML="";
  //$("#progress-modal-header")[0].innerHTML="How much are you getting closer to "+$("#commentId"+str).html().trim()+" ?";
  $("#progress-table").append("<tr><td><img src={{asset('pictures/icons/tiny-plus-black.png')}} > Added to Life list : 1% Progress</td><td style='text-align:right;' >"+$("#commentId"+str).attr("date")+" ago</td></tr>");
  $("#add-achievement-trigger")[0].click();
  getProgressHistory();
}

function submitProgress(){
  $("#progress-table").append("<tr><td><img src={{asset('pictures/icons/tiny-plus-black.png')}} > Made a "+$("#soullified_add_progress_input").val()+" % Progress </td><td style='text-align:right;' >Just Now</td></tr>");
  var achieved=parseFloat($("#achievement-progress-bar-modal")[0].style.width.replace("%",""));
  var progress=parseFloat($("#soullified_add_progress_input").val());
  var newAchievemnt=progress+achieved;
  $("#achievement-progress-bar-modal")[0].style.width=newAchievemnt+"%";
      var url="{{ asset('addprogress/') }}";
        url=url+gGoalId;
         $.get(url,{
             percentage:progress,
        },function(data){   
              if(data.responseCode==200 ){
              }
             else if(data.responseCode==400){//bad request
             }
             else{
             }
         });//It is silly. But you should not write 'json' or any thing as the fourth parameter. It should be undefined. I'll explain it futher down
}


function getProgressHistory() {
      var achieved=0;
      var url="{{ asset('getProgressHistory/') }}";
        url=url+gGoalId;
         //start send the post request
         $.get(url,function(data){   
             //the response is in the data variable
              if(data.responseCode==200 ){
                for (var i = 0; i < data.progressHistory.length; i++) {
                  $("#progress-table").append("<tr><td><img src={{asset('pictures/icons/tiny-plus-black.png')}} > Made a "+data.progressHistory[i].percentage+" % Progress </td><td style='text-align:right;' >"+data.progressHistory[i].date+" ago </td></tr>");
                   achieved=achieved+parseFloat(data.progressHistory[i].percentage);
                };
                $("#achievement-progress-bar-modal")[0].style.width=achieved+"%";
                if(achieved >= 100 ) 
                  $("#progress-input")[0].style.display="none";
                else  
                  $("#progress-input")[0].style.display="block";
              }
         });
       }

function removeLifeGoal(id){
  $("#"+id).fadeOut();
  url="/my-life-list/removegoal/";
  url=url+id.substring(9,id.length);
  $.get(url);
  //alert(id)
}

{%  if app.user %}
function submitSubcomment(commentId)
{

  var content = $("#writeacomment").val();
  if(content.length == 0)
    return true;
  $("#writeacomment").val("");
  var myhtml= '<div class="new-board-preview" style="padding-left: 62px;margin-top: 7px;position:relative;width:100%;margin-left: 0px;height:auto;text-align:left;opacity: 1; min-height: 66px;">'+
                  '<span id="modalDetailCommentDate" style="position: absolute;bottom: 3px;right: 11px;font-size: 12px;font-weight:normal;">Just now</span>'+
                    '<a id="modalDetailCommentOwnerFullname" style="position: absolute;top: 0px;margin-left: 9px;font-size: 12px;font-weight: bold;">'+
                      '{{app.user.profil.fullname}}'+
                    '</a>'+
                    '<img class="comment-thumbnail" style="left: 10px;height: 54px;top: 2px;" src={{app.user.profil.profilPicture}} />'+
                    '<div id="modalDetailCommentTitle"  style="margin-top: 10px;font-size: 12px;padding-bottom: 10px;font-family:sans-serif;display:inline-block;text-align: left;margin-left: 10px;padding-right: 75px;font-weight:normal;">'+content+'</div>';

  var url = "/add/subcomment";
  $.post(url,{
           content:content,
           commentId:commentId,
       });
 $("#writeacommentbody").append(myhtml);

}


function removeSubComment(subcommentId){
 $("#subcomment"+subcommentId).fadeOut();
 var url="/rm/subcomm";
 $.get(url,{subcommentId:subcommentId});
}


{%  else %}
var wantSubcomment=false;
  function submitSubcomment(commentId)
/*  {
    $(".md-overlay").click();
    fakeRegisterTrigger()
    return ;
  }*/
{
    if(!localStorage.getItem("guestAvatar") && !localStorage.getItem("guestName"))
    {
      fakeChooseTrigger();
      wantSubcomment=true;
      return false;
    }

    var content = $("#writeacomment").val();
    if(content.length == 0)
      return true;
    $("#writeacomment").val("");
    var myhtml= '<div class="new-board-preview" style="padding-left: 62px;margin-top: 7px;position:relative;width:100%;margin-left: 0px;height:auto;text-align:left;opacity: 1; min-height: 66px;">'+
                    '<span id="modalDetailCommentDate" style="position: absolute;bottom: 3px;right: 11px;font-size: 12px;font-weight:normal;">Just now</span>'+
                      '<a id="modalDetailCommentOwnerFullname" style="position: absolute;top: 0px;margin-left: 9px;font-size: 12px;font-weight: bold;text-transform:capitalize;">'+
                        localStorage.getItem("guestName")+
                      '</a>'+
                      '<img class="comment-thumbnail" style="left: 10px;height: 54px;top: 2px;" src='+localStorage.getItem("guestAvatar")+' />'+
                      '<div id="modalDetailCommentTitle"  style="white-space:pre-wrap;font-weight:normal;margin-top: 10px;font-size: 12px;padding-bottom: 10px;font-family:sans-serif;display:inline-block;text-align: left;margin-left: 10px;padding-right: 75px;font-weight:normal;">'+content+'</div>';
  
      var url = "/add/subcomment";
      $.post(url,{
             content:content,
             commentId:commentId,
             guestName:localStorage.getItem("guestName"),
             guestAvatar:localStorage.getItem("guestAvatar")
         });
     $("#writeacommentbody").append(myhtml);
     $("#writeacommentbody").scrollTop($("#writeacommentbody").height());
  }  
{%  endif %}


function changeColor(id,color){
    document.getElementById('comment-area').style.color = color;

    $("#color-select-frame a").css("border-color","transparent");
    $("#color-select-frame a").css("box-shadow","none");
    if(true)
    {
     // $("#col"+id).css("border-color","#66afe9");
     // $("#col"+id).css("box-shadow","inset 0 1px 1px rgba(0,0,0,0.075),0 0 8px rgba(102,175,233,0.6)");
      {%  if app.user %}
        updateFavColor(color);
      {% endif %}
    }
}

// ---------------------------------------------------- Soundtrack -------------------------------------------------------------



$("#add-song-form").submit(function(){
  addSong();
  return false;
})

function completeTrack() {
      $("#song-input-echo").val($("#song-input").val())
      $("#song-input-echo").focus();
      $("#song-input").focus();
}

var gSpaceIndex = 1;
var editedId;
var stopTyping;
$("#song-input").on("change keyup paste", function(){
    clearTimeout(stopTyping);
    stopTyping = setTimeout(completeTrack,500);
    if($("#song-input").val().indexOf(" ") == -1) 
      gSpaceIndex = 1;
    var spaceIndex = $("#song-input").val().split(" ").length;
    if(gSpaceIndex < spaceIndex) 
    {
      gSpaceIndex = spaceIndex;
    
      $("#song-input-echo").val($("#song-input").val())
      $("#song-input-echo").focus();
      $("#song-input").focus();
    }


})

var gSpaceIndex = 1;
var gtest;
$("textarea").on("change keyup paste", function(e){
    if((e.keyCode == 13)&&($(this).val().trim() != ""))
      submitComment($(this).attr("id").substr(12));
})


{%  if app.user %}
function hideMainMenue(){
  $("#main-menu-dropdown").fadeOut();
  $("#menu-icon").attr("onClick","displayMainMenue()");
  $("#small-screen-menu").attr("onClick","displayMainMenue()");
  $("#myname").attr("onClick","displayMainMenue()");
}


function updateFavColor(color)
{
    var url="/profil/set/favcolor";    
    $.get(url,{profilId:'{{app.user.profil.id}}',
             favColor:color
           });
}


function deleteComment(commentId)
{
  
  var url = "{{ path('soullifiedlifesoundtrack_delete_comment')}}";
  $("#comment-area"+commentId).parent().fadeOut();  
  $.get(url,{
    commentId:commentId
  })
}


function addComment(trackId)
{
  var content=$("#comment-area"+trackId).val();
  if(content.length == 0) 
    {
      $('#submitTrackCommentButtom'+trackId).fadeOut();
      return true;
    }
  $("#comment-area"+trackId).val("");
  var url = "{{ path('soullifiedlifesoundtrack_add_new_comment')}}";
  $.post(url,{
    content:content,
    trackId:trackId
  },function (data)
  {
    var minHeight="60px";
    commentHtml='<div onMouseenter="displayClose('+data.id+')" onMouseleave="hideClose('+data.id+')" class="col-md-6 col-sm-10 col-xs-10 col-md-offset-3 col-sm-offset-1 col-xs-offset-1 main-comment-area"  style="opacity:1"><span class="input-group-addon" style="border: 0px;border-radius: 0px;background-color: white;"><span class="comment-username" >{{app.user.profil.fullname}}</span><img style="box-shadow: 0px 2px 2px rgba(0, 0, 0, 0.3);opacity:1;cursor:pointer;width:50px;position:absolute;top:2px;left:1px;" src="{{app.user.profil.profilPicture}}"/></span><span id="comment-area'+data.id+'" type="text" class="form-control commented-area" style="min-height:'+minHeight+'" >'+content+'<span class="pic-comment-container" style="height:80px;"></span></span><span id="closeComment'+data.id+'" class="close delete-comment" onClick="deleteComment('+data.id+')">x</span></div>';
    $("#comment-area"+trackId).parent().after(commentHtml);
    $('#submitTrackCommentButtom'+trackId).fadeOut();
  })
}

function displayMainMenue(){
  $("#main-menu-dropdown").fadeIn();
  $("#menu-icon").attr("onClick","hideMainMenue()");
  $("#small-screen-menu").attr("onClick","hideMainMenue()");
  $("#myname").attr("onClick","hideMainMenue()");
}


{%  else %}

function displayMainMenue(){
  $(".big-screen").css("display","list-item");
  $("#menu-icon").attr("onClick","hideBigScreen()");
  $("#small-screen-menu").attr("onClick","hideBigScreen()");
}

function hideBigScreen(){
  $(".big-screen").fadeOut();
  $("#menu-icon").attr("onClick","displayMainMenue()");
  $("#small-screen-menu").attr("onClick","displayMainMenue()");
}

function hideMainMenue(){
  $("#main-menu-dropdown").fadeOut();
  $("#menu-icon").attr("onClick","displayMainMenue()");
  $("#small-screen-menu").attr("onClick","displayMainMenue()");
  $("#myname").attr("onClick","displayMainMenue()");
}
{% endif %}



function playSong(songtrackId,youtubeId)
{
   var songTitle = $("#songTitle"+songtrackId)[0].innerHTML;
   if(youtubeId.length == 0 || youtubeId == "null")
    {
      //searchYoutubeId(songTitle,songtrackId);
      searchSoundCloudId(songTitle,songtrackId)
    }
   else
   {
        $("#player-track-title")[0].innerHTML=songTitle;
        play_track(youtubeId);
 /*     $("#soundcloudplayer").attr("src","https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/"+youtubeId+"&amp;color=ff6600&amp;auto_play=true&amp;show_artwork=true");
      $("#soundcloudplayer").fadeIn();*/
   }
}

function updateYoutubeId(songtrackId,videoId)
{
  var url="{{path('soullifiedlifesoundtrack_update_youtube_id')}}";
  $.get(url,{
             songtrackId:songtrackId,
             videoId:videoId
         },function(data){   
                  $("#playSong"+songtrackId).attr("onClick","playSong("+songtrackId+",'"+videoId+"')"); 
               }); 
}
var search;
var keyWord="";
var laSource=[""];
{%  if app.user %}
var idCache = new Array();
function addSong(songName,songPic)
{
 
if(songName)
{
  keyWord=songName;
  var artist = songName.split("-")[1];
  var title = songName.split("-")[0];
  var newTrackId = 0;
  var search = artist+" "+title;
  var searchId =search.split(" ").join("_");
  if(idCache.length == 0)
      idCache.push(0);
  else
  {
      newTrackId=idCache[idCache.length - 1];
      newTrackId--;
      idCache.push(newTrackId);
  }
  var lyricsLoading = "<span id='lyricsLoading"+newTrackId+"' ><span id='lyricsFading"+newTrackId+"'><img style='margin-right: -50px;opacity: 0.5;z-index: -2;margin-left: 105px;' src='{{asset('pictures/icons/loading.gif')}}' > Searching Lyrics</span></span>";

  var controlHtml='<span class="file-uploader-container upload-track-true-container uploadPhotoNoLyrics2" style="left:inherit;top:45px;opacity:0.8;" class="uploadPhotoNoLyrics" onclick="fakeTrackUploadTrigger('+newTrackId+')">'+
                '<img src="/pictures/icons/camera-big.png" class="updaload-track-pic-img">'+
              '</span>'+
              '<span>'+
                '<img ng-show="track.photos.length == 0" ng-click="fakeBindTrigger(track)" title="Add to a board" id="bind-to-a-board" src="/pictures/icons/bind-black.png" ng-class="{bindNoLyrics:track.lyrics == null,bindNoLyrics2:track.lyrics != null}" class="bindNoLyrics2">'+

                '<img ng-show="track.photos.length != 0" ng-click="fakeBindTrigger(track)" title="Add to a board" id="bind-to-a-board" src="/pictures/icons/bind-white.png" ng-class="{bindNoLyrics:track.lyrics == ,bindNoLyrics2:track.lyrics != }" class="bindNoLyrics2" style="display: none;">'+

               '</span>'+
               '<button id="choose-lyrics-button'+newTrackId+'" class="btn btn-default btn-select-lines noLyricsChooseButton2" onclick="chooseLyrics('+newTrackId+')" style="margin-top: 1%;" ng-class="{noLyricsChooseButton:track.lyrics ==,noLyricsChooseButton2:track.lyrics !=}">'+
                    '<img src="/pictures/icons/lyrics.png">'+
                     'lyrics'+
               '</button>';

  var myhtml='<div class="col-md-6 col-sm-10 col-xs-10 col-md-offset-3 col-sm-offset-1 col-xs-offset-1 main-comment-area" style="margin-top: 50px;" ><textarea id="comment-area'+newTrackId+'" type="text" class="form-control tag-input"  placeholder="What do you think about when you listen to "'+title+'" ?" ></textarea><img src="{{asset("pictures/icons/tag_music.jpg")}}" class="song-tag-icon"></div><span class="board-date">added </span><div class="col-md-6 col-sm-10 col-xs-10 col-md-offset-3 col-sm-offset-1 col-xs-offset-1 sub-container new-track-preview" >'+controlHtml+
      {%  if app.user %}
      '<div class="owner-track" style="position:initial;"><img class="explore-pic-owner" style="margin-right:5px;" src="{{app.user.profil.profilPicture}}">{{app.user.profil.fullName}}</div>'+
      {%  endif %}
      '<button id="done-selecting-button'+newTrackId+'" class="btn btn-success btn-select-lines disabled" onClick="doneSelecting('+newTrackId+')" style="margin-top: 1%;display:none;" >Done selecting</button><img src="{{asset("pictures/icons/lyrics.png")}}" style="top: -8%;opacity: 0;height: 55px;margin-left: 189px;cursor: auto;" /><span id="lyrics'+newTrackId+'"><span id="lyrics'+newTrackId+'"><p class="lyrics-limited">'+lyricsLoading+'</p></span><span id="'+searchId+'"  class="youtube-frame-container"></span></span><span class="new-track-preview-title" ><img src="{{asset("pictures/icons/big-play-black.png")}}" class="play-btn"  id="playSong'+newTrackId+'" ><span id="songTitle'+newTrackId+'">'+title+' -  '+artist+'</span></div>'

    sendTrack(title,artist,null,null,newTrackId,songPic);
    $("#main-row").prepend(myhtml);
    $("#lyricsFading"+newTrackId).fadeOut(5000);
    $("#song-input").val("");
}
else
{
  $("#add-song-loading").fadeIn();
  songName=$("#song-input").val();
  if(songName.length == 0)
    return false;
}

  
}
{%  else%}
function addSong(songName,songPic)
{
  $("#song-input").val("");
  fakeRegisterTrigger();
}
{% endif %}
var nextId=0;
var newTrackId=0;
function sendTrack(title,artist,lyrics,mood,newTrackId,songPic)
{
  console.log("songPic "+songPic);
  var url="{{path('soullifiedlifesoundtrack_add_track')}}";
  $.post(url,{
              title:title,
              artist:artist,
              boardId:boardId,
              mood:mood,
              songPic:songPic,
              lyrics:lyrics?lyrics.trim():null,
              newTrackId:newTrackId,
              },function(data){ 

                nextId=idCache.pop();
                newTrackId = data.songId;

                $("#choose-lyrics-button"+nextId).attr("id","choose-lyrics-button"+newTrackId);
                $("#choose-lyrics-button"+newTrackId).attr("onClick","chooseLyrics("+newTrackId+")");

                $("#done-selecting-button"+nextId).attr("id","done-selecting-button"+newTrackId);
                $("#done-selecting-button"+newTrackId).attr("onClick","doneSelecting("+newTrackId+")");
                
                $("#upload"+nextId).attr("id","upload"+newTrackId);
                $("#lyrics"+nextId).attr("id","lyrics"+newTrackId);

                $("#playSong"+nextId).attr("id","playSong"+data.songtrackId);
                $("#playSong"+data.songtrackId).attr("onClick","playSong("+data.songtrackId+",'"+data.youtubeId+"')"); 

                $("#songTitle"+nextId).attr("id","songTitle"+data.songtrackId);
                $("#lyricsLoading"+nextId).attr("id","lyricsLoading"+newTrackId);

                if(lyrics)
                  return;
                $("#validate-lyrics-button").fadeIn();
                var url='http://api.lyricsnmusic.com/songs?api_key=0ece71190cce454fd5beea3db7ec22&track='+encodeURI(title)+'&artist='+encodeURI(artist);
                $.ajax({
                crossDomain: true,
                contentType: "json; charset=utf-8",
                dataType : "jsonp",
                url: url,
                cache:true,
                }).done(function( data ) {
                    var gdata=data.data.sort(sortingOccur);
                    var lyrics=gdata[0].snippet.trim();
                    $("#lyricsLoading"+newTrackId)[0].innerHTML=lyrics;
                    $("#song-input").val("");
                    sendTrack(title,artist,lyrics,null,newTrackId,songPic);
                  }
                );

                if(!data.youtubeId) 
                    {
                      searchSoundCloudId(data.songTitle,data.songtrackId);
                    }
                });
}

function containsOne(elt){ 
  return elt.title.indexOf(keyWord) > -1 
}

function sortingOccur(a,b){
    return (numbreOfOccurance(b.title+" "+b.artist.name,keyWord) - numbreOfOccurance(a.title+" "+a.artist.name,keyWord))
  }


function numbreOfOccurance(strA,strB)
{
  var total=0;
  var total2=0;
  var tabA=strA.toLowerCase().split(/[\s,?!]+/);
  var tabB=strB.toLowerCase().split(/[\s,?!]+/);

  for (var j = 0; j< tabA.length; j++) 
  {
    for (var i = 0; i < tabB.length; i++) 
    {
      if( tabB[i] == tabA[j] ) {
        total ++ ;
        if( i == j) total++ ;
      }
    };
  };

  for (var j = 0; j< tabB.length; j++) 
  {
    for (var i = 0; i < tabA.length; i++) 
    {
      if( tabB[j] == tabA[i] )
      {
        total2 ++ ;
        if( i == j) total2 ++ ;
      }
    };
  };
  return Math.min(total,total2);
}

function select(id,i)
{
  var lineId=id+""+i;
  var elt=$("#l"+lineId);
  $("#done-selecting-button"+id).attr("class","btn btn-success btn-select-lines");
  elt[0].getAttribute.class="lyrics-line selected";
  elt.attr("class","lyrics selected");
  elt.attr("onClick","deselect("+id+","+i+")");
}

function deselect(id,i)
{
  var lineId=id+""+i;
  var elt=$("#l"+lineId);
  elt.attr("class","lyrics notSelected");
  elt.attr("onClick","select("+id+","+i+")");
}

var debugStr;
function doneSelecting(id)
{
    $(".lyrics.notSelected").fadeOut();
    $(".lyrics.selected").css('background-color','white');
    $(".lyrics.selected").css('color','black');
    $(".lyrics.selected").css('cursor','auto');
    
    if(lyricsFound == false)
    var chosenlyrics = $("#editArea"+id).val();
    else
    {    
      
    var childrenArray=$("#lyrics"+id).children().children();
    var chosenlyrics="";
    for (var i = 0; i < childrenArray.length; i++) {
      if( childrenArray[i].getAttribute('class') == "lyrics selected")
         chosenlyrics=chosenlyrics+childrenArray[i].innerHTML.replace(' <img src="/pictures/icons/tiny-plus-white.png" style="margin-right:1%;">',"\n");
  
    };
  }
  debugStr=chosenlyrics;
  chosenlyrics=chosenlyrics.replace("<lyric>","").replace("</lyric>","").split("\n\n").join("\n")
  var url = "{{path('soullifiedlifesoundtrack_update_chosen_lyrics')}}";
  $.post(url,{
             id:id,
             chosenlyrics:chosenlyrics,
         }); 

  $("#lyrics"+id)[0].innerHTML="<p class='lyrics-limited'>"+chosenlyrics+"</p>";
  $("#done-selecting-button"+id).fadeOut();
  $("#choose-lyrics-button"+id).fadeIn();
}

function checkLyricsFound(id,oldLyrics)
{
  if(lyricsFound == false)
  {
    $("#lyrics"+id)[0].innerHTML="<textarea class='form-control editArea' id='editArea"+id+"'  >"+
                                 oldLyrics.replace('<p class="lyrics-limited">',"").replace("</p>","").trim()+
                                 "</textarea>";
    $("#done-selecting-button"+id).attr("class","btn btn-success btn-select-lines");
  }
  else
    return true;
}


var lyricsFound;
function chooseLyrics(id)
{

  lyricsFound=false;
  var oldLyrics =  $("#lyrics"+id)[0].innerHTML;
  setTimeout(checkLyricsFound,4000,id,oldLyrics);
  $("#choose-lyrics-button"+id).fadeOut();
  $("#done-selecting-button"+id).fadeIn();
  $("#lyrics"+id)[0].innerHTML='<img src="{{asset("pictures/icons/loading.gif")}}" style="margin-left: 24%;margin-top: 31px;opacity: 1;">';
  if($("#lyrics"+id).attr("class")!="ready")
    retrieveFromApi(id,false);
  else
    retrieveFromSoullified(id);
}

function retrieveFromSoullified(id)
{
  var url="{{path('soullifiedlifesoundtrack_get_Full_lyrics_ready')}}";
  $.get(url,{
             trackId:id
         },function(data){   
              //the response is in the data variable
            if(data.responseCode==200 ){
                 // alert(data.commentId);
              if(data.lyrics.length < 10 || data.lyrics.substr(0,8).indexOf("version=") ==0 )
              {
                  lyricsFound = false;
                  return true;
              }
              else
                  lyricsFound=true;

                  if(data.lyrics.indexOf("\n") != -1)
                    var fullLyrics=data.lyrics.trim().split("\n");
                  else
                    var fullLyrics=data.lyrics.trim().split(". ");

                  var myhtml="<span class='lyrics'>";
                   
                  myhtml=myhtml+"<div id=l"+id+"0 class='lyrics notSelected' onClick=select("+id+",0)>  <img src='{{asset('pictures/icons/tiny-plus-white.png')}}' style='margin-right:1%;' >"+fullLyrics[0]+'</div>';

                  for (var i = 1; i < fullLyrics.length; i++) {
                    var lineId=id+""+i;
                    myhtml=myhtml+"<div id=l"+lineId+" class='lyrics notSelected' onClick=select("+id+","+i+")> <img src='{{asset('pictures/icons/tiny-plus-white.png')}}' style='margin-right:1%;' >"+fullLyrics[i]+'</div>';
                   };
                  
                  myhtml += "</span>";
                  $("#lyrics"+id)[0].innerHTML=myhtml;
            }
           else if(data.responseCode==500){//bad request
              console.log("error 500")
           }  
           else{
              console.log("gen error")
           }

    });
}

function retrieveFromApi(id,isDeamon)
{
  var url="{{path('soullifiedlifesoundtrack_get_full_lyrics')}}";
  $.get(url,{
             id:id
         },function(data){   
              //the response is in the data variable
            if(data.responseCode==200 ){
                 // alert(data.commentId);
                 if(isDeamon == false){ 
                                   lyricsFound=true;
                                   if(data.lyrics.indexOf("\n") != -1)
                                     var fullLyrics=data.lyrics.trim().split("\n");
                                   else
                                     var fullLyrics=data.lyrics.trim().split(". ");
                 
                                   var myhtml="<span class='lyrics'>";
                                    
                                   myhtml=myhtml+"<div id=l"+id+"0 class='lyrics notSelected' onClick=select("+id+",0)>  <img src='{{asset('pictures/icons/tiny-plus-white.png')}}' style='margin-right:1%;' >"+fullLyrics[0]+'</div>';
                 
                                   for (var i = 1; i < fullLyrics.length; i++) {
                                     var lineId=id+""+i;
                                     myhtml=myhtml+"<div id=l"+lineId+" class='lyrics notSelected' onClick=select("+id+","+i+")> <img src='{{asset('pictures/icons/tiny-plus-white.png')}}' style='margin-right:1%;' >"+fullLyrics[i]+'</div>';
                                    };
                                   
                                   myhtml += "</span>";
                                   $("#lyrics"+id)[0].innerHTML=myhtml;
                    }

                  $.post("{{ path('soullifiedlifesoundtrack_update_Full_lyrics')}}",{FullLyrics:data.lyrics.replace("<Lyric>","").replace("</Lyric>","").replace("</GetLyricResult>","").trim(),trackId:id});
            }
           else if(data.responseCode==500){//bad request
              console.log("error 500")              
           }  
           else{
              console.log("gen error")
           }

        });
}

 //-------------------------------------------------------------------------------------------------------------
{%  if app.user %}
var Friendevents="";
/*$("#Friend-requests").popover({title:function() {
                       return "<img src='{{asset('pictures/icons/loading.gif')}}' style='margin-left: 60px;' >";                        
                                 },html:true,placement:"bottom"});
*/

function getEvents(){
       $.get("{{ path('get_ajax_requests')}}", //replace it with the secssion
        function(data){   
           //the response is in the data variable
            if(data.responseCode==200 ){
                 Friendevents=data.htmlcode;
                 $("#Friend-requests").popover({title:function() {
                        return Friendevents;                        
                                  },html:true,placement:"bottom"});
            }
         }
       );

}
//--------------------------------------------------------------------------------------------------------------
/*
$(document).ready(function(){
  setTimeout(getEvents,1000);
  FillLyricsDeamons();
})
*/

$(".file-uploader").click(function(){
  var str=($(this).attr("id"))
    clickedId=str.substr(6,str.length);
})

var editId=0;
function getEditId()
  {    
    editedId=0;
    var url= "{{ path('soullifiedlifesoundtrack_gen_new_editId')}}";
    $.get(url,{},function(data){   
          editedId = data.editId;;
          editId = data.editId;
          $(function() {
                new PunkAveFileUploader({ 
                    'uploadUrl': "/commenttrack/upload?editId="+editId,
                    'viewUrl':  "/web/uploads/tmp/attachments/?editId="+editId,
                    'el': '.file-uploader',
                    'exist gingFiles': {{ null | json_encode | raw }},
                    'delaySubmitWhileUploading': '.edit-form' ,
                });
            });
        });
  }
{% endif %}

var deamonsJar= new Array();
function FillLyricsDeamons()
{
  $(".not-ready").each(function(){
    deamonsJar.push(this.id.replace("lyrics",""));
  });
}

function releaseDeamon()
{
  if(deamonsJar.length == 0 )
    return false;
  
  deamonId=deamonsJar.pop();
  retrieveFromApi(deamonId,true);
}

function hideAllNotifs()
{
  hideMainMenue();
}

setInterval(releaseDeamon,50000);
//----------------- youtube api ____________________________________________________________________

/*// The client id is obtained from the Google APIs Console at https://code.google.com/apis/console
// If you run access this code from a server other than http://localhost, you need to register
// your own client id.
var OAUTH2_CLIENT_ID = '552858651186-qr2qifg0mcvmjkennfolu0m4a2d0h45g.apps.googleusercontent.com';
var OAUTH2_SCOPES = [
  'https://www.googleapis.com/auth/youtube'
];

// This callback is invoked by the Google APIs JS client automatically when it is loaded.
googleApiClientReady = function() {
  gapi.auth.init(function() {
    window.setTimeout(checkAuth, 1);
  });
}

// Attempt the immediate OAuth 2 client flow as soon as the page is loaded.
// If the currently logged in Google Account has previously authorized OAUTH2_CLIENT_ID, then
// it will succeed with no user intervention. Otherwise, it will fail and the user interface
// to prompt for authorization needs to be displayed.
function checkAuth() {
  gapi.auth.authorize({
    client_id: OAUTH2_CLIENT_ID,
    scope: OAUTH2_SCOPES,
    immediate: true
  }, handleAuthResult);
}

// Handles the result of a gapi.auth.authorize() call.
function handleAuthResult(authResult) {
  if (authResult) {
    // Auth was successful; hide the things related to prompting for auth and show the things
    // that should be visible after auth succeeds.
    $('.pre-auth').hide();
    loadAPIClientInterfaces();
  } else {
    // Make the #login-link clickable, and attempt a non-immediate OAuth 2 client flow.
    // The current function will be called when that flow is complete.
    $('#login-link').click(function() {
      gapi.auth.authorize({
        client_id: OAUTH2_CLIENT_ID,
        scope: OAUTH2_SCOPES,
        immediate: false
        }, handleAuthResult);
    });
  }
}

// Loads the client interface for the YouTube Analytics and Data APIs.
// This is required before using the Google APIs JS client; more info is available at
// http://code.google.com/p/google-api-javascript-client/wiki/GettingStarted#Loading_the_Client
function loadAPIClientInterfaces() {
  gapi.client.load('youtube', 'v3', function() {
    handleAPILoaded();
  });
}
e
//gapi.client.setApiKey("AIzaSyCB8mGG8WCJF-FDuLdT5RRCsbPxjsKc5hc")

//------------------------------------------------- search youtube id  ----------------------------------
function searchYoutubeId(str,songtrackId) {
  var request = gapi.client.youtube.search.list({
    q: str+" lyrics",
    part: 'snippet',
  });


request.execute(function(response) {
    var videoId =response.result.items[0].id.videoId;
    updateYoutubeId(songtrackId,videoId);
  });

}*/


function searchSoundCloudId(str,songtrackId) {
  var url="http://api.soundcloud.com/tracks.json?client_id=229b5c9f7dca199464f6a3d38a9a16d1&q="+str+"&limit=5"
  $.get(url,{},function(data){ 
           updateYoutubeId(songtrackId,data[0].id);
                })
      }

function handleAPILoaded() {
  $('#search-button').attr('disabled', false);
  gapi.client.setApiKey("AIzaSyCB8mGG8WCJF-FDuLdT5RRCsbPxjsKc5hc")
}


var moodSelectorCounter=0;
var defaultMood = 1;
function incrementMoodSelector () {
  if(moodSelectorCounter == 4)
    moodSelectorCounter = 0;
  moodSelectorCounter++;
  $("#mood-slector").val(moodSelectorCounter);
}
var moodInterval=setInterval(incrementMoodSelector,2000)

$("#mood-slector").click(function(){
    defaultMood=0;
    clearInterval(moodInterval);
  });

function displayClose(commentId){
  {% if app.user %}
    $("#closeComment"+commentId)[0].style.display="inherit";
  {%  endif %}
}

function fakeFilterTrigger(strSrc)
{  
  $("#fake-filter-trigger").click();
}

function fakeRegisterTrigger()
{
  $("#sing-up-btn").click();
}

var avatarChosen=false;
function fakeChooseTrigger () {
  $('#fake-choose-avatar-trigger').click();

  var avatarsHTML="";
  var avatarsArray=[
                    'sheldon',
                    'lenny',
                    'harold',
                    'rajif',
                    'einstein',
                    'gandi',
                    'mario',
                    'steve',
                    'alien',
                    'blondy',
                    'kim',
                    'woods',
                    'indiangirl',
                    'hiphop',
                    'charli',
                    'hitler',
                    'lara',
                    'king',
                    'queen',
                    'moneyMan',
                    'jackson',
                    'milky',
                    'astraunaut',
                    'diver',
                    'red',
                    'neo',
                    'chegavara',
                    'driver',
                    'devil',
                    'paps',
                    'kayty',
                    'terminator',
                    'pokahantis',
                    'vikings',
                    ]


  if($("#avatars-container")[0].innerHTML.trim().length == 0)
  {
    for (var i = 0; i < avatarsArray.length; i++) {
        avatarsHTML = avatarsHTML + "<img src='/avatars/"+avatarsArray[i]+".jpg'  class='avatar'>" ;
      };
  
      $("#avatars-container")[0].innerHTML=avatarsHTML;
      $(".avatar").click(function() {
        avatarChosen = true;
        localStorage.setItem("guestAvatar",this.src);
        localStorage.setItem("guestName",$("#guestName").val());
        $("#fresh-comment-thumbnail").attr("src",this.src);
        $("#avatars-container").find("img").attr("class","avatar");
        $(this).attr("class","avatar avatar-selected");
      })
  }
}
function adjustAction()
{
  $(".md-overlay").click();
  fakeFilterTrigger();
}

function hideClose(commentId){
 $("#closeComment"+commentId)[0].style.display="none";
}
var firstTimeScrollDefined=true;


function fakeCreatTrigger(nickName) {
  lvl=0;
  maxLvl=0;
  $(".lvl1").fadeOut();
  $(".lvl2").fadeOut();
  $("#fake-create-new-trigger").click();
  $('#main-container').css("-webkit-filter","blur(6px)");
  if($('#cover-image').css("-webkit-filter").indexOf("5") == -1)
    $('#cover-image').css("-webkit-filter","blur(6px)");

  $("#youMightAlso")[0].style.display="none";
  $("#myboardsBody")[0].innerHTML = "";
  $("#myboardsBody").css("margin-left","0px");
  var url="/angular/myboards";
  $.get(url,{
    nickName:nickName
  },function (data) {
    var finalHtml="";
    var exploreHtml="";
    maxLvl=data.boards.length;
    for (var i = 0; i <data.boards.length; i++) {
      var trackName="";
      var coverurl="";
      if (data.boards[i].coverurl)
        coverurl=data.boards[i].coverurl.replace("large","small");
      if (data.boards[i].song) {
        trackName='<span  style="text-align:left;color: rgb(139, 139, 139);font-size: 11px;opacity:0.5;"><img style="margin-right: 5px;opacity: 0.3;" src="/pictures/icons/small-song-black.png">'+data.boards[i].song+'</span>'+
                  '      <hr style="margin-bottom:0;margin-top:5px;">';
      }
      if(i < 5)
        finalHtml=finalHtml+'<a href="/life/#/board/'+data.boards[i].url+'" class="my-boards"  style="background-image: url('+coverurl+');background-size: cover;text-decoration:initial;text-align:left;">';
      else if(i >=5 && i <10)
        finalHtml=finalHtml+'<a  href="/life/#/board/'+data.boards[i].url+'" class="my-boards lvl1"  style="background-image: url('+coverurl+');background-size: cover;">';
      else if(i >= 10)
        finalHtml=finalHtml+'<a  href="/life/#/board/'+data.boards[i].url+'" class="my-boards lvl2"  style="background-image: url('+coverurl+');background-size: cover;">';

      finalHtml=finalHtml+
      '    <div >'+
      '      <span  style="text-align:left;position:absolute;bottom:25px;color:rgb(213, 206, 206);">'+encodeHTML(data.boards[i].name)+'</span>'+
        '    <div class="likes-comments">'+
        '      <img class="small-community" src="/pictures/icons/small-owner.png">'+
        '      <span id="nbrOfComments">'+data.boards[i].nbrLikes+'</span>'+
        '      <img src="/pictures/icons/small-comment.png" class="like-buttons" style="opacity:0.3;margin-left:10px;cursor:default;">'+
        '      <span id="nbrOfComments">'+data.boards[i].nbrComments+'</span>'+
        '    </div>'+
        '  </div>'+
        '</a>';
    }
    $("#youMightAlso")[0].style.display="block";
    $("#myboardsBody")[0].innerHTML = '<img src="/pictures/icons/prev-black.png" class="prevCard" onClick="prevLvl()"  >'+finalHtml+'<img src="/pictures/icons/next-black.png" class="nextCard" onClick="exploreScrollDown()"  >';

  })
}
var isVelcroWallpaper = false;

function setIsVelcroWallpaper() {
  isVelcroWallpaper = true;
}

function upaloadBoardBackground(editId,srcStr) {
  $(".md-overlay").click();
    fakeFilterTrigger();
    var url="{{ path('update_uploaded_background') }}";
    $.get(url,{editId:editId,
               boardId:boardId
              });
    editId = 0;
    commentEditId = 0;
    velcro = 0;
    isVelcroWallpaper=false;
}


function fakeUplaoderTrigger(){
  $("#background-file-uploader").click();
}
var isProfilPic = false;
var isAvatar = false;

function fakePreviewTriger () {
    $(".md-overlay").click();
    $('#preview-trigger').click() ;
    isProfilPic = true;
}

var trackUploadId=-1;
function fakeTrackUploadTrigger(uploadTrackId) {
  trackUploadId=uploadTrackId;
  $("#fake-uplaod-track-trigger").click();

}

function saveUploadedTrackBackground(id,src)
{
  $("#track-container"+trackUploadId).css("background-image","url('"+src+"')");
  $("#track-container"+trackUploadId).css("background-size","cover");
  $("#track-container"+trackUploadId).css("color","white");
  $("#track-container"+trackUploadId).css("height","360px");
  //$("#track-container"+trackUploadId).css("box-shadow","2px -75px 159px rgba(0, 0, 0, 0.62) inset");
  $("#track-container"+trackUploadId).find(".play-btn").attr("src","/pictures/icons/play-button.png");
  var story = $("#modalUploadphotoDescription").val();
  if(story.length > 0)
    $("#lyrics"+trackUploadId)[0].innerHTML='<p class="lyrics-limited ng-binding">'+story+'</p></span>'
  var url="/soundtrack/confitmuploadphoto";
    $.post(url,{
             story:story,
             editId:id,
             trackId:trackUploadId
        });
  trackUploadId = -1;
}


function changeBackgroundTimeOut(trackId,photos)
{
   if( photos.idx >= photos.length )
     photos.idx = 0;
   else
    photos.idx = photos.idx + 1;

  $("#track-container"+trackId).css("background-image","url('/web/uploads/tmp/attachments/"+photos[photos.idx].editId+"/medium/"+photos[photos.idx].src+"')");
}

function fakeModalClose() {
  $(".md-overlay").click();
}

function bindBoardToSong(boardId,trackId){
  $("#tryBindMe"+boardId).css("background-color","green");
  fakeModalClose();
  console.log("boardId : "+boardId+" trackId : "+trackId);
  var url="/angular/bindsongboard";
  $.get(url,{
             boardId:boardId,
             trackId:trackId
         },function(data){
            if(data.responseCode == 200 )
              document.location.href="/life/#/board/"+data.boardId;
         });
}

var intervalArray = [];
var depassementRight=false;
function isEnoughtSpace() {
  var lnumber=$('#comment-container')[0];
  var tabComments=$(".comment");
  var selfHeight=lnumber.offsetHeight-10;
  var selfWidth=lnumber.offsetWidth;
  var selfTop=lnumber.offsetTop;
  var selfLeft=lnumber.offsetLeft;
  var sameLineTab=[];
  for (var i = 0; i < tabComments.length; i++) {
    if(((tabComments[i].offsetTop > selfTop) &&
       (tabComments[i].offsetTop < selfTop + tabComments[i].offsetHeight - 20 ))
        || ((tabComments[i].offsetTop < selfTop) &&
       (tabComments[i].offsetTop > selfTop - tabComments[i].offsetHeight + 20 )))
        {
          var leftDistance  = tabComments[i].offsetLeft -selfLeft -selfWidth;
          var rightDistance = tabComments[i].offsetLeft +tabComments[i].offsetWidth -selfLeft ;
          sameLineTab.push({
                            comment:tabComments[i],
                            distance:tabComments[i].offsetTop - selfTop,
                            selfTop:tabComments[i].offsetTop,
                            leftDistance: leftDistance,
                            rightDistance:rightDistance,
                           })

          if(selfLeft < 0 || selfLeft +selfWidth +10 > window.innerWidth )
            return false
          if(tabComments[i].offsetLeft > selfLeft )
          {
            if(leftDistance <= 0)
            {
              if(depassementRight==false)
                lnumber.style.left = parseInt(lnumber.style.left.replace("px",""))+leftDistance+"px";
              else
                 return false;
            }
          }
          else
          {
            if(rightDistance >= 0)
            {
              depassementRight=true;
            }
          }

        }
  };
  return true;
}



function intersect(tab1,tab2) {
  var interTab=[];
  for (var i = 0; i < tab1.length; i++) {
    for (var j = 0; j < tab2.length; j++) {
      if(tab1[i].comment == tab2[j].comment)
        interTab.push(tab2[j])
    };
  };

return interTab;
}

function selectFilter(filterId){
  $("#validate-filter-button").attr("onClick","validateFilter("+filterId+")")
  if(filterId == 1)
    $("#cover-image").css("-webkit-filter","blur(5px)");
  else if(filterId == 2)
    $("#cover-image").css("-webkit-filter","contrast(132%) brightness(100%)");
}


function validateFilter(filterId)
{
  var url="/validate/filter";
  $.get(url,{filterId:filterId,
              boardId:boardId
            });
}

function likeBoard(){
  {%  if app.user %}
  var url="/like/board";
  $.get(url,{
              boardId:boardId
            }); 
  $("#like-icon-preview").attr("onClick","unLikeBoard()");
  $("#like-icon-preview").attr("src","{{asset('pictures/icons/like-pink.png')}}")
  {%  else %}
    fakeRegisterTrigger()
  {%  endif %}
}

function unLikeBoard(){
  var url="/unlike/board";
  $.get(url,{
              boardId:boardId
            }); 
  $("#like-icon-preview").attr("onClick","likeBoard()");
  $("#like-icon-preview").attr("src","{{asset('pictures/icons/liked-white.png')}}")
}

var lvl=0;
var maxLvl=0;
function nextLvl() {
  if(lvl==0)
    $(".prevCard").fadeIn();

  if((lvl+2)*5 > maxLvl)
      $(".nextCard").fadeOut();

  lvl++;
  $(".lvl"+lvl).fadeIn();
  var marginLeft=lvl*(-1050);
  $("#myboardsBody").css("margin-left",marginLeft+"px");
}

function prevLvl() {
  if(lvl==1)
    $(".prevCard").fadeOut();
  
  $(".lvl"+lvl).fadeOut();
  lvl--;
  var marginLeft=lvl*(-1050);
  $("#myboardsBody").css("margin-left",marginLeft+"px");

  if((lvl+2)*5 <= maxLvl)
      $(".nextCard").fadeIn();
}

$("#d").click(function(){

})


function expandSearchInput()
{
  $("#search-input").fadeIn();
  $("#search-input").css("width","250px");
  $("#search-button")[0].style.display="none";
}


function fillPreviewBackground() {
  var previewHtml='<img  class="small-background-preview md-close" style="margin-left:85px;" onClick="setPredefinedBackground(this)" src="{{asset("pictures/background/bluewood.jpg")}}" >'+
                       '<img class="small-background-preview md-close" onClick="setPredefinedBackground(this)" src="{{asset("pictures/background/default.jpg")}}"> '+
                        '<img  class="small-background-preview md-close" onClick="setPredefinedBackground(this)" src="{{asset("pictures/background/brownwood.jpg")}}" >'+
                        '<img  class="small-background-preview md-close" onClick="setPredefinedBackground(this)"  src="{{asset("pictures/background/paper1.jpg")}}" >'+
                        '<img  class="small-background-preview md-close" onClick="setPredefinedBackground(this)"  src="{{asset("pictures/background/whitewood.jpg")}}" >'+
                        '<img  class="small-background-preview md-close" onClick="setPredefinedBackground(this)"  src="{{asset("pictures/background/greenboard.jpg")}}" >'+
                        '<img  class="small-background-preview md-close" onClick="setPredefinedBackground(this)" src="{{asset("pictures/background/blackboard.jpg")}}" >';
 if($("#preview-backrounds")[0].innerHTML.trim.length == 0);
  $("#preview-backrounds")[0].innerHTML=previewHtml;
}

function scribbleAsAGuest()
{
 //$("#guestName").val("");
 //$("#guestName").tooltip({title:"pick up a name",placement:"right"});
 //$("#guestName").fadeIn();
 $("#guestName").focus();
 $("#guestEmail").val($("#emailInput").val());
 if($("#guestName").val().length > 0)
        {
           $("#fresh-comment-username")[0].innerHTML=$("#guestName").val();
           if(wantSubcomment==false)
            $("#submit-comment").click();
           else
            {
              wantSubcomment=false;
              $("#submitSubcomment").click();
            }
         }
}

function checkPreComments()
{

}

var autocompleteOption, a;
jQuery(function(){
    autocompleteOption = { serviceUrl:"{{ path('ruspeena_search_board')}}" };
    a = $('#search-input').autocompleteBoard(autocompleteOption);
}); 

function getNextExploreWave(nickName,isTrigged)
{
  
  var url="/angular/myboards";
  $.get(url,{
    nickName:nickName,
    scrollIndex:exploreScrollIndex
  },function (data) {
    var exploreHtml="";
    maxLvl=data.boards.length;
    for (var i = 0; i <data.boards.length; i++) {
      var trackName="";
      var coverurl="";
      if (data.boards[i].coverurl)
        coverurl=data.boards[i].coverurl.replace("large","small");
      else
        coverurl="/pictures/background/whitewood.jpg";

      exploreHtml=exploreHtml+'<a href="/life/#/board/'+data.boards[i].url+'" class="box explore-board">'+
      '<div class="owner-track" ><img class="explore-pic-owner" style="margin-right:5px;" src="'+encodeHTML(data.boards[i].ownerPic)+'">'+encodeHTML(data.boards[i].ownerName)+
      '</div>'+
      '<div style="position:absolute;color:grey;right:5px;top:5px;font-size:10px;">'+data.boards[i].date+' ago</div>'+
      '          <img ng-show="board.coverurl" src="'+encodeHTML(coverurl)+'" style="width: 100%;">'+
      '       <div class="explore-board-title">'+encodeHTML(data.boards[i].name)+'</div>'+
      '        <div class="explore-board-info">'+
      '              <p class="explore-board-description">'+(data.boards[i].desc!=null?encodeHTML(data.boards[i].desc):"")+'</p>'+
      '          <div class="likes-comments">  '+
      '            <span >'+
      '              <img class="small-community" src="{{asset("pictures/icons/small-owner.png")}}" style="opacity:1">'+
      '              <span id="nbrOfComments">'+(data.boards[i].nbrLikes!=0?data.boards[i].nbrLikes:"")+'</span>'+
      '            </span>'+
      '            <span>'+
      '              <img  src="{{asset("pictures/icons/small-comment-black.png")}}"  class="like-buttons" style=";margin-'+'left:10px;cursor:default;opacity:0.5;">    '+    
      '              <span id="nbrOfComments">'+data.boards[i].nbrComments+' Scribbles</span>'+
      '            </span>'+
      '            </div>'+
      '        </div>'+
     /* '      <span class="pin-track" ng-show="templateType == 3">'+
      '        <core-icon-button icon="av:my-library-music" id="core_icon_button1"></core-icon-button>'+
      '      </span>'+
      '      <button class="btn btn-sm btn-detault pin-button" ng-show="!board.pinned" ng-click="pinBoard(board)">'+
      '        <img title="Pin Bord to ScrapBook"  src="{{ asset("pictures/icons/pin-black.png") }}" style="height: 20px;cursor: '+'pointer;"> '+
      '      </button>'+
      '      <button class="btn btn-sm btn-detault pin-button" ng-show="!board.pinned" ng-click="pinBoard(board)">'+
      '        <img title="Pin Bord to ScrapBook"  src="{{ asset("pictures/icons/pin-black.png") }}" style="height: 20px;cursor: '+'pointer;"> '+
      '      </button>'+
      '      <button class="btn btn-sm btn-detault pin-button pinned" ng-show="board.pinned" ng-click="unPinBoard(board)">'+
      '        <img title="Unpin Bord from ScrapBook"  src="{{ asset("pictures/icons/pin-black.png") }}" style="height: '
      '+20px;cursor: pointer;"> '+
      '      </button>'+*/
      '</a>';
    };
    $("#explorer-loading-html").fadeOut();
    $("#explore-container").append(exploreHtml);
    if(isTrigged==true)
      $('html, body').animate({
            scrollTop:$("#main-container").height()+1
            }, 'slow');

    if(data.boards.length > 0)
      ignoreExploreScrolling=false;
  })
}


ignoreScrolling=false;
var exploreHeaderTop=false;
var ignoreExploreScrolling=false;
var exploreScrollIndex=0;
$(document).scroll(function(){
            //console.log("scrolling")
            if((-$(this).scrollTop() + $("#main-container").height() < 0) && exploreHeaderTop == false)
              {
                $("#explore-header").attr("class","fixed-explore-header");
                $("#user-profil-card")[0].style.position="fixed";
                exploreHeaderTop=true;
              }
            else if((-$(this).scrollTop() + $("#main-container").height() > 0) && exploreHeaderTop == true)
               {
                $("#explore-header").attr("class","vola-explore-header");
                $("#user-profil-card")[0].style.position="absolute";
                $(".tag-panel").fadeOut()
                exploreHeaderTop=false;
              }
            if( $("#explore-body").height() - $(window).scrollTop() < 500 && ignoreExploreScrolling == false)
              {
                //console.log("bottom reached");
                getNextExploreWave();
                exploreScrollIndex++;
                ignoreExploreScrolling=true;
              }
      })


function getExplorerSoundtrack(nickName) {
  var myhtml="";
  $.get("{{path('soullifiedlifesoundtrack_get_angular_tracks')}}?nickName="+nickName+"&?idx=0",
        {},
        function(data){
        if(data.trackArray.length==0)
            myhtml='<div class="col-md-6 col-sm-10 col-xs-10 col-md-offset-3 col-sm-offset-1 col-xs-offset-1 sub-container new-track-preview" style="margin-bottom:550px;font-size: 20px;text-align: center;padding-top: 45px;font-weight: initial;opacity: 1;padding-bottom: 35px;" >'+
                      'Behind every song a <b >story</b><br>'+
                      'whether it  describes your <b > mood </b>today,<br>'+
                      'revives an old <b > memory </b>, <br>'+
                      'or just a song that keep<b > buzzing </b> in your head.'+
                      '<br>'+
                      'if your life had a <b > Soundtrack </b> <br> how it sounds like ?'+
              '</div>';

        for (var i = 0; i < data.trackArray.length; i++) {
        {%  if app.user %}
          var controlHtml='<span class="file-uploader-container upload-track-true-container uploadPhotoNoLyrics2" style="left:inherit;top:45px;opacity:0.8;" class="uploadPhotoNoLyrics" onclick="fakeTrackUploadTrigger('+data.trackArray[i].id+')">'+
                        '<img src="/pictures/icons/camera-big.png" class="updaload-track-pic-img">'+
                      '</span>'+
                      '<span>'+
                        '<img ng-show="track.photos.length == 0" onClick="fakeBindTrigger('+data.trackArray[i].id+')" title="Add to a board" id="bind-to-a-board" src="/pictures/icons/bind-black.png" ng-class="{bindNoLyrics:track.lyrics == null,bindNoLyrics2:track.lyrics != null}" class="bindNoLyrics2">'+
                       '</span>'+
                       '<button id="choose-lyrics-button'+data.trackArray[i].id+'" class="btn btn-default btn-select-lines noLyricsChooseButton2" onclick="chooseLyrics('+data.trackArray[i].id+')" style="margin-top: 1%;';

                        if(data.trackArray[i].lyrics=="null")
                          controlHtml=controlHtml+"position:initial;";


                      controlHtml=controlHtml+'" ng-class="{noLyricsChooseButton:track.lyrics ==,noLyricsChooseButton2:track.lyrics !=}">'+
                            '<img src="/pictures/icons/lyrics.png">'+
                             'lyrics'+
                       '</button>';

        {%  else %}
          var controlHtml="";
        {%  endif %}
          var commentsHtml="";
          for (var j = 0; j < data.trackArray[i].comments.length; j++) {
            
            commentsHtml=commentsHtml+'<div onMouseenter="displayClose('+data.trackArray[i].comments[j].id+')" onMouseleave="hideClose('+data.trackArray[i].comments[j].id+')" class="col-md-6 col-sm-10 col-xs-10 col-md-offset-3 col-sm-offset-1 col-xs-offset-1 sub-container main-comment-area"  style="opacity:1;"  >'+
                '<span class="input-group-addon" style="border: 0px;border-radius: 0px;background-color: white;">'+
                  '<a href="/life/#/scrapbook/'+data.trackArray[i].comments[j].ownerNickname+'" class="comment-username" >'+
                          data.trackArray[i].comments[j].ownerFullname+
                   '</a>'+
                   '<img style="box-shadow: 0px 2px 2px rgba(0, 0, 0, 0.3);background-color:white;opacity:1;cursor:pointer;width:50px;position:absolute;top:2px;left:1px;" src="'+data.trackArray[i].comments[j].ownerProfilPicture+'"/>'+
                '</span>'+
                '<span id="comment-area'+data.trackArray[i].comments[j].id+'" class="form-control commented-area" >'+
                      data.trackArray[i].comments[j].content+
                '</span>'+
                '<span id="closeComment'+data.trackArray[i].comments[j].id+'" class="close delete-comment" onClick="deleteComment('+data.trackArray[i].comments[j].id+')">'+
               ' x</span>'+
            '</div>';
          };
          myhtml=myhtml+'<div class="col-md-6 col-sm-10 col-xs-10 col-md-offset-3 col-sm-offset-1 col-xs-offset-1 main-comment-area" ><textarea onKeydown="displaySubmitCommentArea('+data.trackArray[i].id+')"  id="comment-area'+data.trackArray[i].id+'" type="text" class="form-control tag-input"  placeholder="What do you think about when you listen to '+data.trackArray[i].title.split("-")[0]+'?" ></textarea>'+
          '<button class="btn btn-sm btn-primary" id="submitTrackCommentButtom'+data.trackArray[i].id+'" style="display:none;position: absolute;top: -5px;right: 4px;border-radius: 3px;" onClick="submitTrackComment('+data.trackArray[i].id+')">submit</button>'+
          '<img src="{{asset("pictures/icons/tag_music.jpg")}}" class="song-tag-icon"><span class="file-uploader-container"><div id="upload'+data.trackArray[i].id+'" class="file-uploader"></div></span></div>';
          myhtml=myhtml+commentsHtml;
          myhtml=myhtml+'<div class="col-md-6 col-sm-10 col-xs-10 col-md-offset-3 col-sm-offset-1 col-xs-offset-1 sub-container new-track-preview" >'+controlHtml+
          '<div class="owner-track" style="position:initial;" ><img class="explore-pic-owner" style="margin-right:5px;position:initial;" src="'+data.trackArray[i].profilPictureSrc+'">'+data.trackArray[i].profilFullname+
          '</div>'+

          '<button id="done-selecting-button'+data.trackArray[i].id+'" class="btn btn-success btn-select-lines disabled" onClick="doneSelecting('+data.trackArray[i].id+')" style="margin-top: 1%;display:none;" >Done selecting</button><img src="{{asset("pictures/icons/lyrics.png")}}" style="top: -8%;opacity: 0;height: 55px;margin-left: 189px;cursor: auto;" /><span id="lyrics'+data.trackArray[i].id+'"><span id="lyrics'+data.trackArray[i].id+'"><p class="lyrics-limited">';
          
          if(data.trackArray[i].lyrics!="null")
            myhtml=myhtml+data.trackArray[i].lyrics;
          else
            myhtml=myhtml+"\n\n";
          
          myhtml=myhtml+'</p></span><span class="board-date">'+data.trackArray[i].date+' ago</span><span id="'+'searchId'+'"  class="youtube-frame-container"></span></span><span class="new-track-preview-title" ><img src="{{asset("pictures/icons/big-play-black.png")}}" class="play-btn"  id="playSong'+data.trackArray[i].youtubeId+'" >'+data.trackArray[i].title+'</div>'
                  };
            $("#explore-soundtrack-container")[0].innerHTML=myhtml;
            {%  if app.user %}
              if(nickName=="{{app.user.username}}")
                $("#song-input").attr("label","Type song Name or SoundClound Url");
              else
                $("#song-input").attr("label","#Tag "+nickName+" in a song");
            {%  else %}
                $("#song-input").attr("label","#Tag "+nickName+" in a song");
            {%  endif %}
            setTimeout('$(".tag-panel").fadeIn()',1000);
            $('html, body').animate({
              scrollTop:$("#main-container").height()+1
            }, 'slow');
          })//end data
return true;
}

function displaySubmitCommentArea(commentId) {
  if($("#comment-area"+commentId).val().length>0)
    $("#submitTrackCommentButtom"+commentId)[0].style.display="block";
  else
    $("#submitTrackCommentButtom"+commentId)[0].style.display="none";
  
}

 function submitTrackComment(trackId){
  {% if app.user %}
    addComment(trackId);
  {% else %}
    fakeRegisterTrigger()
  {% endif %}
}


{%  if app.user %}
function fakeBindTrigger(trackId){
  $("#fake-bind-trigger").click();
  var loadingHTML='<div id="loading-html" style="text-align:center;background-color:white;width:100%;width: 50%;margin-left: 30%;box-shadow:0 1px 1px 0px rgba(0, 0, 0, 0.2), 0 0 2px 1px rgba(255, 255, 255, 0.5)"><img src="/pictures/icons/loading.gif" style="opacity:1;margin-top: 10px;margin-top: 12px;margin-bottom: 13px;margin-right: -0px;"><span class="awesome-loading">loading Awesomness ...</span></div>';
  $("#myBoardToSelectBody")[0].innerHTML = loadingHTML;
  var url="/angular/myboards";
  $.get(url,{
    nickName:'{{app.user.username}}'
  },function (data) {
    var finalHtml="";
    for (var i = 0; i < data.boards.length; i++) {
      var trackName="";
      var coverurl="";
      if (data.boards[i].coverurl)
        coverurl=data.boards[i].coverurl.replace("large","small");
      if (data.boards[i].song) {
        trackName='<span  style="text-align:left;color: rgb(139, 139, 139);font-size: 11px;opacity:0.5;"><img style="margin-right: 5px;opacity: 0.3;" src="/pictures/icons/small-song-black.png">'+data.boards[i].song+'</span>'+
                  '      <hr style="margin-bottom:0;margin-top:5px;">';
      }
      finalHtml=finalHtml+'<div id="tryBindMe'+data.boards[i].id+'" onClick="bindBoardToSong('+data.boards[i].id+','+trackId+')" class="my-boards" onClick="fakeModalClose()" style="background-image: url('+coverurl+');background-size: cover;">'+
      '    <a>'+
      '    <div >'+
      '      <div class="board-description" style="text-align:left;" >'+(data.boards[i].desc!=null?data.boards[i].desc:"")+'</div>'+
        '    <div class="likes-comments">'+
        '      <img class="small-community" src="/pictures/icons/small-owner.png">'+
        '      <img src="/pictures/icons/small-comment-black.png" class="like-buttons" style="opacity:0.3;margin-left:10px;cursor:default;">'+
        '      <span id="nbrOfComments">'+data.boards[i].nbrComments+'</span>'+
        '    </div>'+
        '    <div class="controls-buttons" style="display: block;">'+
        '      <hr style="margin-bottom:0;margin-top:5px;">'+
        trackName+
        '      <span class="board-title" style="text-align:left;">'+data.boards[i].name+'</span>'+
        '    </div>'+
        '  </div>'+
        '  </a>'+
        '</div>';
    };
    $("#myBoardToSelectBody")[0].innerHTML = finalHtml;
  })
}
{% endif %}



var expandId
function expand_board(inputId)
{
  expandId=inputId;
  var newboard=$("#boardId"+inputId);
  $("body").append(newboard)
  $("#boardId"+inputId).animate({left: "0",top:"0",width:"100%",height:"100%"}, 300);
}

function exploreScrollDown()
{
  getNextExploreWave("iceman",true);
}

var handsOffTheTrollBool=false;
function handsOffTheTroll()
{
  //$('#main-container').click();
  handsOffTheTrollBool=true;
}


function submitPic()
{
  var url="{{ path('submit_angular_photo') }}";
  var left = $("#comment-area").offset().left+15;
  var top  = $("#comment-area").offset().top+9;
  top  = parseInt(top);
  left = parseInt(left)
  top  = top / window.innerHeight;
  left = left / window.innerWidth;
  left = left * 100 -14;
  top  = top * 100 -10;
  $.get(url,{editId:editId,
            boardId:boardId,
            posx:left.toString().substr(0,4),
            posy:top.toString().substr(0,4)
   },function(data){   
            if(data.responseCode==200 ){
              $("#trollphoto").attr("id","boardPhoto"+data.photoId);
              $("#pictureId"+editId).attr("pictureId",data.photoId);
              $("#rotateSmallPic"+editId).attr("onClick",'rotateslider("boardPhoto'+data.photoId+'","pic")');
              $("#delteSmallPic"+editId).attr("onClick",'rmAngularPic("boardPhoto'+data.photoId+'")');
              location.reload();
              //getEditId();
               /*$scope.photos.push({Id:data.photoId,
                           Date:"Just Now",
                           folder:editId,
                           posx:left.toString().substr(0,4),
                           posy:top.toString().substr(0,4),
                           rotation:0,
                           title:$("#comment-input-area").val(),
                           url:1,
                          });*/
          }
       });
}

function encodeHTML(s) {
    return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/"/g, '&quot;');
}



$("#guestName").change(function(){
   var url="/verifusername";
   var regTest= new RegExp("^[a-zA-Z0-9_$@]*$");
   if(regTest.test($("#guestName").val()))
                 {
                   $("#guestName").css("border","1px solid #C9CED6");
                   $("#validate-username-button").removeAttr("disabled");
                   return false;
                 }
   $.get(url,{username:$(this).val()},
        function(data){   
           //the response is in the data variable
           if(data.resultat=="found") {
                  invalidusername=true;
                  console.log("username exist !!")
                  $("#username_token").fadeIn();
                  $("#validate-username-button").attr("disabled","true");
                  $("#guestName").css("border","rgb(243, 148, 148) 1px solid")
            }
            else if(data.resultat!="found") {
                  invalidusername=false;
                  $("#username_token").fadeOut();
                  if(regTest.test($("#guestName").val()))
                    {
                      $("#guestName").css("border","1px solid #C9CED6");
                      $("#validate-username-button").removeAttr("disabled");
                    }
                  else
                    {
                      $("#guestName").css("border","rgb(243, 148, 148) 1px solid");
                      $("#validate-username-button").attr("disabled","true");
                    }
            }
           else{
              alert("An unexpeded error occured.");
           }
         }
       );
    })


    $("#form-avatar").submit(function () {
      if(localStorage.getItem("guestAvatar"))
      {
        scribbleAsAGuest();
        $(".md-overlay").click();
      }
      else
        $("#no-chosen-avatar").fadeIn();
      return false;
    })

    function psstAlert() {
      $("#psstText").css("display","initial");
      $("#psstText").css("-webkit-animation","animation 1000ms linear both");
      $("#psstText").css("animation","animation 1000ms linear both");
    }

    </script>
    <script type="text/javascript" src="{{ asset('js/jquery-ui.min.js')}} "></script>
    <script type="text/javascript" src="{{ asset('js/jquery.easy-overlay.js')}} "></script>
    <script type="text/javascript" src="{{ asset('js/lightbox-2.6.min.js')}} "></script>
    <script type="text/javascript" src="{{ asset('js/bootstrap.min.js') }}" ></script>
    {%  if app.user %}
    <script type="text/javascript" src="{{ asset('js/underscore-min.js')}} "></script>
    <script type="text/javascript" src="{{ asset('js/jquery.fileupload.js')}} "></script>
    <script type="text/javascript" src="{{ asset('js/jquery.iframe-transport.js')}} "></script>
    <script type="text/javascript" src="{{ asset('js/FileUploader.js')}} "></script>
    {%  endif %}
    <script type="text/javascript" src="{{ asset('js/jquery.autocomplete.js')}}"></script>
    <script type="text/javascript" src="{{ asset('js/jquery.autocomplete1.js')}}"></script>
    {% include "soullifiedboardBundle:templates:StyleTemplate.html.twig" %}
    <script type="text/javascript" src="{{ asset('js/soundcloud.sdk.js')}}" ></script>
    <script type="text/javascript" src="{{ asset('js/board.js')}}" ></script>
    <script type="text/javascript" src="{{ asset('js/classie.js')}}" ></script>
    <script type="text/javascript" src="{{ asset('js/modalEffects.js')}}" ></script>
    <script type="text/javascript" src="{{ asset('js/jquery.tinycolorpicker.min.js')}}"></script>
    {% include "soullifiedboardBundle:templates:JsTemplate.html.twig" %}
    {% include "soullifiedboardBundle:templates:playerTemplate.html.twig" %}
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-63824291-1', 'auto');
    ga('send', 'pageview');
</script>
</html><!-- all rights reserved {%if 'souller' in url('render_home_page') %}souller{% else %}scribbler party{%  endif %}